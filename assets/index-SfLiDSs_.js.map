{"version":3,"file":"index-SfLiDSs_.js","sources":["../../src/interpreter/lexer.ts","../../src/interpreter/parser.ts","../../src/App/components/Diagram/ArrowTopLeftBottomRight.tsx","../../src/App/components/Diagram/ArrowBottomLeftTopRight.tsx","../../src/App/components/Diagram/Diagram.tsx","../../src/App/components/DiagramPreview.tsx","../../src/App/components/StyledCodeEditor/StyledCodeEditor.tsx","../../src/App/components/AdaptiveButton.tsx","../../src/App/components/LiveEditor/Layout.tsx","../../src/App/components/LiveEditor/helper.ts","../../src/App/components/LiveEditor/LiveEditor.tsx","../../src/App/components/LiveEditor/useExportDiagram.ts","../../src/App/components/LiveEditor/useEditorContent.ts","../../src/App/App.tsx","../../src/main.tsx"],"sourcesContent":["export enum DiagramTokenKind {\r\n\tEOF = 0,\r\n\tSYMBOL,\r\n\tKEYWORD,\r\n\r\n\tLEFT_PAREN,\r\n\tRIGHT_PAREN,\r\n\tLEFT_CURLY,\r\n\tRIGHT_CURLY,\r\n\tSEMICOLON,\r\n\tWHITE_SPACE,\r\n}\r\n\r\nexport type DiagramToken = {\r\n\tkind: DiagramTokenKind;\r\n\ttext: string;\r\n\tlineNumber: number;\r\n\tcharNumber: number;\r\n};\r\n\r\nconst KEYWORDS: string[] = [\r\n\t\"for\",\r\n\t\"if\",\r\n\t\"else\",\r\n\t\"while\",\r\n\t\"do\",\r\n];\r\n\r\nconst LITERAL_TOKENS: Record<\r\n\tstring,\r\n\tDiagramTokenKind\r\n> = {\r\n\t\"{\": DiagramTokenKind.LEFT_CURLY,\r\n\t\"}\": DiagramTokenKind.RIGHT_CURLY,\r\n\t\"(\": DiagramTokenKind.LEFT_PAREN,\r\n\t\")\": DiagramTokenKind.RIGHT_PAREN,\r\n\t\";\": DiagramTokenKind.SEMICOLON,\r\n};\r\n\r\nexport type Lexer = {\r\n\tcontent: string;\r\n\tcontentLength: number;\r\n\tcursorPos: number;\r\n\r\n\tlineNumber: number;\r\n\tcharNumber: number;\r\n};\r\n\r\nconst removeComments = (\r\n\tcontent: string,\r\n): string => {\r\n\tlet cleanContent = \"\";\r\n\r\n\tlet contentPos = 0;\r\n\twhile (contentPos < content.length) {\r\n\t\tif (\r\n\t\t\tcontentPos + 1 < content.length &&\r\n\t\t\tcontent[contentPos] === \"/\" &&\r\n\t\t\tcontent[contentPos + 1] === \"/\"\r\n\t\t) {\r\n\t\t\twhile (\r\n\t\t\t\tcontentPos < content.length &&\r\n\t\t\t\tcontent[contentPos] !== \"\\n\"\r\n\t\t\t) {\r\n\t\t\t\tcontentPos++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcleanContent += content[contentPos];\r\n\t\tcontentPos++;\r\n\t}\r\n\r\n\treturn cleanContent;\r\n};\r\n\r\nexport const lexerInit = (\r\n\tcontent: string,\r\n): Lexer => {\r\n\tconst cleanedContent = removeComments(\r\n\t\tcontent.normalize(),\r\n\t);\r\n\r\n\treturn {\r\n\t\tcontent: cleanedContent,\r\n\t\tcontentLength: cleanedContent.length,\r\n\t\tcursorPos: 0,\r\n\t\tcharNumber: 1,\r\n\t\tlineNumber: 1,\r\n\t};\r\n};\r\n\r\nexport const lexerGetNextTokenThenAdvance = (\r\n\tl: Lexer,\r\n): DiagramToken => {\r\n\tconst token: DiagramToken = {\r\n\t\tkind: DiagramTokenKind.EOF,\r\n\t\ttext: \"\",\r\n\t\tlineNumber: l.lineNumber,\r\n\t\tcharNumber: l.charNumber,\r\n\t};\r\n\r\n\tif (l.cursorPos >= l.contentLength) {\r\n\t\treturn token;\r\n\t}\r\n\r\n\ttoken.text = l.content[l.cursorPos];\r\n\tl.cursorPos++;\r\n\tl.charNumber++;\r\n\r\n\tif (/\\s/.test(token.text)) {\r\n\t\ttoken.kind = DiagramTokenKind.WHITE_SPACE;\r\n\t\tif (token.text === \"\\n\") {\r\n\t\t\tl.lineNumber++;\r\n\t\t\tl.charNumber = 1;\r\n\t\t}\r\n\t\treturn token;\r\n\t}\r\n\r\n\tif (token.text in LITERAL_TOKENS) {\r\n\t\ttoken.kind = LITERAL_TOKENS[token.text];\r\n\t\treturn token;\r\n\t}\r\n\r\n\twhile (\r\n\t\tl.cursorPos < l.contentLength &&\r\n\t\t!(l.content[l.cursorPos] in LITERAL_TOKENS) &&\r\n\t\t!/\\s/.test(l.content[l.cursorPos])\r\n\t) {\r\n\t\ttoken.text += l.content[l.cursorPos];\r\n\t\tl.cursorPos++;\r\n\t\tl.charNumber++;\r\n\t}\r\n\r\n\tif (KEYWORDS.includes(token.text)) {\r\n\t\ttoken.kind = DiagramTokenKind.KEYWORD;\r\n\t\treturn token;\r\n\t}\r\n\r\n\ttoken.kind = DiagramTokenKind.SYMBOL;\r\n\treturn token;\r\n};\r\n\r\nexport const lexerGetAllTokens = (\r\n\tl: Lexer,\r\n): DiagramToken[] => {\r\n\tconst tokens: DiagramToken[] = [];\r\n\tlet token: DiagramToken;\r\n\twhile (\r\n\t\t(token = lexerGetNextTokenThenAdvance(l))\r\n\t\t\t.kind !== DiagramTokenKind.EOF\r\n\t) {\r\n\t\ttokens.push(token);\r\n\t}\r\n\treturn tokens;\r\n};\r\n","import {\r\n\tDiagramToken,\r\n\tDiagramTokenKind,\r\n} from \"./lexer\";\r\n\r\nexport enum DiagramNodeKind {\r\n\tEOF = 0,\r\n\tERROR,\r\n\tPROCESS,\r\n\tLOOP_FIRST,\r\n\tLOOP_LAST,\r\n\tIF_ELSE,\r\n\tFUNCTION,\r\n}\r\ntype DiagramNodeEOF = {\r\n\tkind: DiagramNodeKind.EOF;\r\n};\r\n\r\ntype DiagramNodeError = {\r\n\tkind: DiagramNodeKind.ERROR;\r\n\tcaretOffset: number;\r\n\tlineNumber: number;\r\n\tcharNumber: number;\r\n\tcontext: string;\r\n\treason: string;\r\n};\r\n\r\ntype DiagramNodeProcess = {\r\n\tkind: DiagramNodeKind.PROCESS;\r\n\tbody: DiagramToken[];\r\n};\r\n\r\ntype DiagramNodeLoopFirst = {\r\n\tkind: DiagramNodeKind.LOOP_FIRST;\r\n\tcondition: DiagramToken[];\r\n\tbody: DiagramNode[];\r\n};\r\n\r\ntype DiagramNodeLoopLast = {\r\n\tkind: DiagramNodeKind.LOOP_LAST;\r\n\tcondition: DiagramToken[];\r\n\tbody: DiagramNode[];\r\n};\r\n\r\ntype DiagramNodeIfElse = {\r\n\tkind: DiagramNodeKind.IF_ELSE;\r\n\tcondition: DiagramToken[];\r\n\tbodyIf: DiagramNode[];\r\n\tbodyElse: DiagramNode[];\r\n};\r\n\r\ntype DiagramNodeFunction = {\r\n\tkind: DiagramNodeKind.FUNCTION;\r\n\tdeclaration: DiagramToken[];\r\n\tbody: DiagramNode[];\r\n};\r\n\r\nexport type DiagramNode =\r\n\t| DiagramNodeEOF\r\n\t| DiagramNodeProcess\r\n\t| DiagramNodeLoopFirst\r\n\t| DiagramNodeLoopLast\r\n\t| DiagramNodeIfElse\r\n\t| DiagramNodeFunction\r\n\t| DiagramNodeEOF\r\n\t| DiagramNodeError;\r\n\r\nexport type Parser = {\r\n\ttokens: DiagramToken[];\r\n\ttokenLength: number;\r\n\tcursorPos: number;\r\n};\r\n\r\nexport const parserInit = (\r\n\ttokens: DiagramToken[],\r\n): Parser => {\r\n\treturn {\r\n\t\ttokens: tokens,\r\n\t\ttokenLength: tokens.length,\r\n\t\tcursorPos: 0,\r\n\t};\r\n};\r\n\r\nconst parserCollectTokensBetween = (\r\n\tp: Parser,\r\n\tstartToken: DiagramTokenKind,\r\n\tstopToken: DiagramTokenKind,\r\n): DiagramToken[] => {\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn [];\r\n\t}\r\n\tif (p.tokens[p.cursorPos].kind !== startToken) {\r\n\t\treturn [];\r\n\t}\r\n\t// Consume the start token\r\n\tp.cursorPos++;\r\n\r\n\t// Does not include the start but includes the stop token\r\n\tconst tokens: DiagramToken[] = [];\r\n\r\n\tlet depth = -1;\r\n\tlet token: DiagramToken;\r\n\twhile (p.cursorPos < p.tokenLength) {\r\n\t\ttoken = p.tokens[p.cursorPos];\r\n\t\tp.cursorPos++;\r\n\t\tif (token.kind === startToken) {\r\n\t\t\tdepth--;\r\n\t\t}\r\n\t\tif (token.kind === stopToken) {\r\n\t\t\tdepth++;\r\n\t\t}\r\n\t\ttokens.push(token);\r\n\r\n\t\tif (depth === 0) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t// The cursor is pointing the token immediately after\r\n\t// the stop token\r\n\treturn tokens;\r\n};\r\n\r\nconst parserSkipWhiteSpace = (\r\n\tp: Parser,\r\n): void => {\r\n\twhile (\r\n\t\tp.cursorPos < p.tokenLength &&\r\n\t\tp.tokens[p.cursorPos].kind ===\r\n\t\t\tDiagramTokenKind.WHITE_SPACE\r\n\t) {\r\n\t\tp.cursorPos++;\r\n\t}\r\n};\r\n\r\nconst buildMissingTokenError = (\r\n\tmarkerToken: DiagramToken,\r\n\tat: string,\r\n\tmissingToken: string,\r\n): DiagramNodeError => {\r\n\tconst { text, lineNumber, charNumber } =\r\n\t\tmarkerToken;\r\n\tconst reason = `Incomplete ${at} declaration. Missing a \"${missingToken}\" token.`;\r\n\treturn {\r\n\t\tkind: DiagramNodeKind.ERROR,\r\n\t\treason,\r\n\t\tcontext: text,\r\n\t\tcaretOffset: text.length,\r\n\t\tlineNumber,\r\n\t\tcharNumber,\r\n\t};\r\n};\r\n\r\nconst buildUnexpectedTokenError = (\r\n\tmarkerToken: DiagramToken,\r\n\terrorToken: DiagramToken,\r\n\tat: string,\r\n\texpectedToken: string,\r\n): DiagramNodeError => {\r\n\tconst { text: markerTokenText } = markerToken;\r\n\tconst {\r\n\t\ttext: errorTokenText,\r\n\t\tlineNumber,\r\n\t\tcharNumber,\r\n\t} = errorToken;\r\n\tconst reason = `Unexpected token found in ${at} declaration. Expected a \"${expectedToken}\" token but found \"${errorTokenText}\" instead.`;\r\n\treturn {\r\n\t\tkind: DiagramNodeKind.ERROR,\r\n\t\treason,\r\n\t\tcontext: `${markerTokenText} ${errorTokenText}`,\r\n\t\tcaretOffset: markerTokenText.length + 1,\r\n\t\tlineNumber,\r\n\t\tcharNumber,\r\n\t};\r\n};\r\n\r\nconst parserBuildLoopFirstNode = (\r\n\tp: Parser,\r\n): DiagramNodeLoopFirst | DiagramNodeError => {\r\n\tconst node: DiagramNodeLoopFirst = {\r\n\t\tkind: DiagramNodeKind.LOOP_FIRST,\r\n\t\tbody: [],\r\n\t\tcondition: [],\r\n\t};\r\n\t// Set \"for\" token as marker\r\n\tlet markerToken: DiagramToken =\r\n\t\tp.tokens[p.cursorPos - 1];\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"(\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-first loop\",\r\n\t\t\t\"(\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found is not a \"(\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.LEFT_PAREN\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"test-first loop\",\r\n\t\t\t\"(\",\r\n\t\t);\r\n\t}\r\n\t// Set \"(\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\r\n\tnode.condition = parserCollectTokensBetween(\r\n\t\tp,\r\n\t\tDiagramTokenKind.LEFT_PAREN,\r\n\t\tDiagramTokenKind.RIGHT_PAREN,\r\n\t);\r\n\t// If the condition has at least one element,\r\n\t// set the last token token as marker\r\n\t// Otherwise, keep  \"(\" token as marker\r\n\tif (node.condition.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tnode.condition[node.condition.length - 1];\r\n\t}\r\n\t// If the condition is empty, the \")\" token is missing\r\n\t// Or the condition is not empty but \")\" is not found\r\n\tif (\r\n\t\tnode.condition.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_PAREN\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-first loop\",\r\n\t\t\t\")\",\r\n\t\t);\r\n\t}\r\n\t// Consume \")\" token from condition\r\n\tnode.condition.pop();\r\n\t// By this point, \")\" token is the marker\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"{\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-first loop\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found is not a \"{\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.LEFT_CURLY\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"test-first loop\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// Set \"{\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\r\n\tconst bodyTokens = parserCollectTokensBetween(\r\n\t\tp,\r\n\t\tDiagramTokenKind.LEFT_CURLY,\r\n\t\tDiagramTokenKind.RIGHT_CURLY,\r\n\t);\r\n\r\n\t// If body has at least one token,\r\n\t// set the last token as marker .\r\n\t// If body has no token, keep \"{\" as marker\r\n\tif (bodyTokens.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tbodyTokens[bodyTokens.length - 1];\r\n\t}\r\n\t// If the body has no token, the declaration is incomplete\r\n\t// Or the body has tokens, but \"}\" is not found\r\n\tif (\r\n\t\tbodyTokens.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_CURLY\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-first loop\",\r\n\t\t\t\"}\",\r\n\t\t);\r\n\t}\r\n\t// Consume \"}\" token from body\r\n\tbodyTokens.pop();\r\n\r\n\tnode.body = parserGetAllNodes(\r\n\t\tparserInit(bodyTokens),\r\n\t);\r\n\treturn node;\r\n};\r\n\r\nconst parserBuildLoopLastNode = (\r\n\tp: Parser,\r\n): DiagramNodeLoopLast | DiagramNodeError => {\r\n\tconst node: DiagramNodeLoopLast = {\r\n\t\tkind: DiagramNodeKind.LOOP_LAST,\r\n\t\tbody: [],\r\n\t\tcondition: [],\r\n\t};\r\n\r\n\t// Set \"do\" token as marker\r\n\tlet markerToken = p.tokens[p.cursorPos - 1];\r\n\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"{\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found is not a \"{\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.LEFT_CURLY\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// Set \"{\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\r\n\tconst bodyTokens = parserCollectTokensBetween(\r\n\t\tp,\r\n\t\tDiagramTokenKind.LEFT_CURLY,\r\n\t\tDiagramTokenKind.RIGHT_CURLY,\r\n\t);\r\n\r\n\t// If body has at least one token,\r\n\t// set the last token as marker and consume it.\r\n\t// If body has no token, keep \"{\" as marker\r\n\tif (bodyTokens.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tbodyTokens[bodyTokens.length - 1];\r\n\t}\r\n\t// If the body has no token, the declaration is incomplete\r\n\t// Or the body has tokens, but \"}\" is not found\r\n\tif (\r\n\t\tbodyTokens.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_CURLY\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\"}\",\r\n\t\t);\r\n\t}\r\n\t// Consume the \"}\" token in body\r\n\tbodyTokens.pop();\r\n\t// By this point, the marker is \"}\" token\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"while\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\"while\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found after \"}\" is not a \"while\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\t\tDiagramTokenKind.KEYWORD ||\r\n\t\tp.tokens[p.cursorPos].text !== \"while\"\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\"while\",\r\n\t\t);\r\n\t}\r\n\t// Set \"while\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\t// Consume \"while token\"\r\n\tp.cursorPos++;\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"(\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\"(\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found is not a \"(\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.LEFT_PAREN\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\"(\",\r\n\t\t);\r\n\t}\r\n\t// Set \"(\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\r\n\tnode.condition = parserCollectTokensBetween(\r\n\t\tp,\r\n\t\tDiagramTokenKind.LEFT_PAREN,\r\n\t\tDiagramTokenKind.RIGHT_PAREN,\r\n\t);\r\n\t// If the condition has at least one element,\r\n\t// set the last token token as marker\r\n\t// Otherwise, keep  \"(\" token as marker\r\n\tif (node.condition.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tnode.condition[node.condition.length - 1];\r\n\t}\r\n\t// If the condition is empty, the \")\" token is missing\r\n\t// Or the condition is not empty but \")\" is not found\r\n\tif (\r\n\t\tnode.condition.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_PAREN\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\")\",\r\n\t\t);\r\n\t}\r\n\t// Consume \")\" token from condition\r\n\tnode.condition.pop();\r\n\t// At this point, \")\" is the marker\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \";\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\";\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found after \")\" is not a \";\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.SEMICOLON\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"test-last loop\",\r\n\t\t\t\";\",\r\n\t\t);\r\n\t}\r\n\t// Consume semicolon token\r\n\tp.cursorPos++;\r\n\r\n\t// Only build the body nodes if the parent declaration is correct\r\n\tnode.body = parserGetAllNodes(\r\n\t\tparserInit(bodyTokens),\r\n\t);\r\n\treturn node;\r\n};\r\n\r\nconst parserBuildIfElseNode = (\r\n\tp: Parser,\r\n): DiagramNodeIfElse | DiagramNodeError => {\r\n\tconst node: DiagramNodeIfElse = {\r\n\t\tkind: DiagramNodeKind.IF_ELSE,\r\n\t\tcondition: [],\r\n\t\tbodyIf: [],\r\n\t\tbodyElse: [],\r\n\t};\r\n\t// Set \"for\" token as marker\r\n\tlet markerToken: DiagramToken =\r\n\t\tp.tokens[p.cursorPos - 1];\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"(\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"branching block (if)\",\r\n\t\t\t\"(\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found is not a \"(\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.LEFT_PAREN\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"branching block (if)\",\r\n\t\t\t\"(\",\r\n\t\t);\r\n\t}\r\n\t// Set \"(\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\tnode.condition = parserCollectTokensBetween(\r\n\t\tp,\r\n\t\tDiagramTokenKind.LEFT_PAREN,\r\n\t\tDiagramTokenKind.RIGHT_PAREN,\r\n\t);\r\n\t// If the condition has at least one element,\r\n\t// set the last token token as marker\r\n\t// Otherwise, keep  \"(\" token as marker\r\n\tif (node.condition.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tnode.condition[node.condition.length - 1];\r\n\t}\r\n\t// If the condition is empty, the \")\" token is missing\r\n\t// Or the condition is not empty but \")\" is not found\r\n\tif (\r\n\t\tnode.condition.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_PAREN\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"branching block (if)\",\r\n\t\t\t\")\",\r\n\t\t);\r\n\t}\r\n\t// Consume \")\" token from condition\r\n\tnode.condition.pop();\r\n\t// By this point, \")\" token is the marker\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"{\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"branching block (if)\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found is not a \"{\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.LEFT_CURLY\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"branching block (if)\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// Set \"{\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\r\n\tconst bodyIfTokens = parserCollectTokensBetween(\r\n\t\tp,\r\n\t\tDiagramTokenKind.LEFT_CURLY,\r\n\t\tDiagramTokenKind.RIGHT_CURLY,\r\n\t);\r\n\t// If body has at least one token,\r\n\t// set the last token as marker .\r\n\t// If body has no token, keep \"{\" as marker\r\n\tif (bodyIfTokens.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tbodyIfTokens[bodyIfTokens.length - 1];\r\n\t}\r\n\t// If the body has no token, the declaration is incomplete\r\n\t// Or the body has tokens, but \"}\" is not found\r\n\tif (\r\n\t\tbodyIfTokens.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_CURLY\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"branching block (if)\",\r\n\t\t\t\"}\",\r\n\t\t);\r\n\t}\r\n\t// Consume \"}\" token from body\r\n\tbodyIfTokens.pop();\r\n\t// Only parse the body after the declaration is valid\r\n\t// the body of if branch has to be parsed here\r\n\t// before possible return\r\n\tnode.bodyIf = parserGetAllNodes(\r\n\t\tparserInit(bodyIfTokens),\r\n\t);\r\n\tparserSkipWhiteSpace(p);\r\n\t// The branching block is complete\r\n\t// No need for error at this point\r\n\tif (\r\n\t\tp.cursorPos >= p.tokenLength ||\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\t\tDiagramTokenKind.KEYWORD ||\r\n\t\tp.tokens[p.cursorPos].text !== \"else\"\r\n\t) {\r\n\t\treturn node;\r\n\t}\r\n\t// The cursor is pointing at \"else\" token\r\n\t// Set \"else\" as marker and consume it\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\tp.cursorPos++;\r\n\t// By this point, \"else\" is the marker\r\n\tparserSkipWhiteSpace(p);\r\n\t// If the cursor is out of bound, \"{\" token is missing\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"branching block (if-else)\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// The first non-whitespace found is not a \"{\" token\r\n\t// but something else\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\tDiagramTokenKind.LEFT_CURLY\r\n\t) {\r\n\t\treturn buildUnexpectedTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\tp.tokens[p.cursorPos],\r\n\t\t\t\"branching block (if-else)\",\r\n\t\t\t\"{\",\r\n\t\t);\r\n\t}\r\n\t// Set \"{\" token as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\r\n\tconst bodyElseTokens =\r\n\t\tparserCollectTokensBetween(\r\n\t\t\tp,\r\n\t\t\tDiagramTokenKind.LEFT_CURLY,\r\n\t\t\tDiagramTokenKind.RIGHT_CURLY,\r\n\t\t);\r\n\t// If body has at least one token,\r\n\t// set the last token as marker .\r\n\t// If body has no token, keep \"{\" as marker\r\n\tif (bodyElseTokens.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tbodyElseTokens[bodyElseTokens.length - 1];\r\n\t}\r\n\t// If the body has no token, the declaration is incomplete\r\n\t// Or the body has tokens, but \"}\" is not found\r\n\tif (\r\n\t\tbodyElseTokens.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_CURLY\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"branching block (if-else)\",\r\n\t\t\t\"}\",\r\n\t\t);\r\n\t}\r\n\t// Consume \"}\" token from body\r\n\tbodyElseTokens.pop();\r\n\r\n\tnode.bodyElse = parserGetAllNodes(\r\n\t\tparserInit(bodyElseTokens),\r\n\t);\r\n\r\n\treturn node;\r\n};\r\n\r\nconst parserGetNextNodeThenAdvance = (\r\n\tp: Parser,\r\n): DiagramNode => {\r\n\tparserSkipWhiteSpace(p);\r\n\tif (p.cursorPos >= p.tokenLength) {\r\n\t\treturn {\r\n\t\t\tkind: DiagramNodeKind.EOF,\r\n\t\t};\r\n\t}\r\n\tconst token = p.tokens[p.cursorPos];\r\n\tp.cursorPos++;\r\n\tif (token.kind === DiagramTokenKind.KEYWORD) {\r\n\t\tswitch (token.text) {\r\n\t\t\tcase \"for\":\r\n\t\t\tcase \"while\":\r\n\t\t\t\treturn parserBuildLoopFirstNode(p);\r\n\t\t\tcase \"do\":\r\n\t\t\t\treturn parserBuildLoopLastNode(p);\r\n\t\t\tcase \"if\":\r\n\t\t\t\treturn parserBuildIfElseNode(p);\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tconst tokens: DiagramToken[] = [token];\r\n\tlet markerToken = token;\r\n\r\n\tif (\r\n\t\tmarkerToken.kind ===\r\n\t\tDiagramTokenKind.SEMICOLON\r\n\t) {\r\n\t\treturn {\r\n\t\t\tkind: DiagramNodeKind.PROCESS,\r\n\t\t\tbody: [],\r\n\t\t};\r\n\t}\r\n\r\n\t// Consume tokens until \";\" or \"{\" token is found\r\n\twhile (\r\n\t\tp.cursorPos < p.tokenLength &&\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\t\tDiagramTokenKind.SEMICOLON &&\r\n\t\tp.tokens[p.cursorPos].kind !==\r\n\t\t\tDiagramTokenKind.LEFT_CURLY\r\n\t) {\r\n\t\tmarkerToken = p.tokens[p.cursorPos];\r\n\t\ttokens.push(p.tokens[p.cursorPos]);\r\n\t\tp.cursorPos++;\r\n\t}\r\n\r\n\t// Neither \";\" or \"{\" token is found\r\n\t// The loop terminates becaues EOF\r\n\t// Also assumed that the use ris trying to write a process\r\n\t// instead of a function\r\n\tif (\r\n\t\tp.cursorPos >= p.tokenLength ||\r\n\t\t(p.tokens[p.cursorPos].kind !==\r\n\t\t\tDiagramTokenKind.LEFT_CURLY &&\r\n\t\t\tp.tokens[p.cursorPos].kind !==\r\n\t\t\t\tDiagramTokenKind.SEMICOLON)\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"process\",\r\n\t\t\t\";\",\r\n\t\t);\r\n\t}\r\n\r\n\tif (\r\n\t\tp.tokens[p.cursorPos].kind ===\r\n\t\tDiagramTokenKind.SEMICOLON\r\n\t) {\r\n\t\tp.cursorPos++;\r\n\t\treturn {\r\n\t\t\tkind: DiagramNodeKind.PROCESS,\r\n\t\t\tbody: tokens,\r\n\t\t};\r\n\t}\r\n\r\n\t// It is confirmed that the loop stopped\r\n\t// because it encountered a \"{\" token\r\n\t// Set it as marker\r\n\tmarkerToken = p.tokens[p.cursorPos];\r\n\r\n\tconst bodyTokens = parserCollectTokensBetween(\r\n\t\tp,\r\n\t\tDiagramTokenKind.LEFT_CURLY,\r\n\t\tDiagramTokenKind.RIGHT_CURLY,\r\n\t);\r\n\r\n\t// If the condition has at least one element,\r\n\t// set the last token token as marker\r\n\t// Otherwise, keep  \"{\" token as marker\r\n\tif (bodyTokens.length > 0) {\r\n\t\tmarkerToken =\r\n\t\t\tbodyTokens[bodyTokens.length - 1];\r\n\t}\r\n\t// If the condition is empty, the \"}\" token is missing\r\n\t// Or the condition is not empty but \"}\" is not found\r\n\tif (\r\n\t\tbodyTokens.length === 0 ||\r\n\t\tmarkerToken.kind !==\r\n\t\t\tDiagramTokenKind.RIGHT_CURLY\r\n\t) {\r\n\t\treturn buildMissingTokenError(\r\n\t\t\tmarkerToken,\r\n\t\t\t\"function\",\r\n\t\t\t\"}\",\r\n\t\t);\r\n\t}\r\n\t// Consume the \"}\" token from body\r\n\tbodyTokens.pop();\r\n\r\n\treturn {\r\n\t\tkind: DiagramNodeKind.FUNCTION,\r\n\t\tdeclaration: tokens,\r\n\t\tbody: parserGetAllNodes(\r\n\t\t\tparserInit(bodyTokens),\r\n\t\t),\r\n\t};\r\n};\r\n\r\nexport const parserGetAllNodes = (\r\n\tp: Parser,\r\n): DiagramNode[] => {\r\n\tconst nodes: DiagramNode[] = [];\r\n\tlet node: DiagramNode;\r\n\twhile (\r\n\t\t(node = parserGetNextNodeThenAdvance(p))\r\n\t\t\t.kind !== DiagramNodeKind.EOF\r\n\t) {\r\n\t\tnodes.push(node);\r\n\t\tif (node.kind === DiagramNodeKind.ERROR) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn nodes;\r\n};\r\n","import { FC } from \"react\";\r\nimport {\r\n\tSvgIconProps,\r\n\tSvgIcon,\r\n} from \"@mui/material\";\r\n\r\nexport const ArrowTopLeftBottomRight: FC<\r\n\tSvgIconProps\r\n> = (props) => {\r\n\tconst { sx } = props;\r\n\r\n\treturn (\r\n\t\t<SvgIcon\r\n\t\t\tsx={{\r\n\t\t\t\tposition: \"absolute\",\r\n\t\t\t\twidth: \"100%\",\r\n\t\t\t\theight: \"100%\",\r\n\t\t\t\t...sx,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<svg\r\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\tpreserveAspectRatio=\"none\"\r\n\t\t\t\tfill=\"none\"\r\n\t\t\t\tviewBox=\"0 0 5 5\"\r\n\t\t\t\tstrokeWidth=\"0.1\"\r\n\t\t\t>\r\n\t\t\t\t<line\r\n\t\t\t\t\tx1=\"0\"\r\n\t\t\t\t\ty1=\"0\"\r\n\t\t\t\t\tx2=\"5\"\r\n\t\t\t\t\ty2=\"5\"\r\n\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\tstrokeLinecap=\"round\"\r\n\t\t\t\t/>\r\n\t\t\t</svg>\r\n\t\t</SvgIcon>\r\n\t);\r\n};\r\n","import { FC } from \"react\";\r\nimport {\r\n\tSvgIconProps,\r\n\tSvgIcon,\r\n} from \"@mui/material\";\r\n\r\nexport const ArrowBottomLeftTopRight: FC<\r\n\tSvgIconProps\r\n> = (props) => {\r\n\tconst { sx } = props;\r\n\r\n\treturn (\r\n\t\t<SvgIcon\r\n\t\t\tsx={{\r\n\t\t\t\tposition: \"absolute\",\r\n\t\t\t\twidth: \"100%\",\r\n\t\t\t\theight: \"100%\",\r\n\t\t\t\t...sx,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<svg\r\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\tpreserveAspectRatio=\"none\"\r\n\t\t\t\tfill=\"none\"\r\n\t\t\t\tviewBox=\"0 0 5 5\"\r\n\t\t\t\tstrokeWidth=\"0.1\"\r\n\t\t\t>\r\n\t\t\t\t<line\r\n\t\t\t\t\tx1=\"0\"\r\n\t\t\t\t\ty1=\"5\"\r\n\t\t\t\t\tx2=\"5\"\r\n\t\t\t\t\ty2=\"0\"\r\n\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\tstrokeLinecap=\"round\"\r\n\t\t\t\t/>\r\n\t\t\t</svg>\r\n\t\t</SvgIcon>\r\n\t);\r\n};\r\n","import { FC, Fragment, ReactNode } from \"react\";\r\nimport {\r\n\tBox,\r\n\tGrid,\r\n\tTypographyProps,\r\n\tTypography,\r\n\tStack,\r\n} from \"@mui/material\";\r\nimport { grey } from \"@mui/material/colors\";\r\n\r\nimport { ArrowTopLeftBottomRight } from \"./ArrowTopLeftBottomRight\";\r\nimport { ArrowBottomLeftTopRight } from \"./ArrowBottomLeftTopRight\";\r\nimport {\r\n\tDiagramNode,\r\n\tDiagramNodeKind,\r\n\tDiagramToken,\r\n} from \"interpreter\";\r\n\r\ntype DiagramWrapperProps = {\r\n\tchildren: ReactNode | ReactNode[];\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nconst DiagramWrapper: FC<DiagramWrapperProps> = (\r\n\tprops,\r\n) => {\r\n\tconst {\r\n\t\tchildren,\r\n\t\tborderTop,\r\n\t\tborderBottom,\r\n\t\tborderLeft,\r\n\t\tborderRight,\r\n\t} = props;\r\n\treturn (\r\n\t\t<Box\r\n\t\t\tsx={{\r\n\t\t\t\tborderStyle: \"solid\",\r\n\t\t\t\tborderLeftWidth: borderLeft ? 2 : 0,\r\n\t\t\t\tborderTopWidth: borderTop ? 2 : 0,\r\n\t\t\t\tborderBottomWidth: borderBottom ? 2 : 0,\r\n\t\t\t\tborderRightWidth: borderRight ? 2 : 0,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{children}\r\n\t\t</Box>\r\n\t);\r\n};\r\n\r\ntype DiagramComponentTextProps =\r\n\tTypographyProps & {\r\n\t\tchildren?: string;\r\n\t};\r\nconst DiagramComponentText: FC<\r\n\tDiagramComponentTextProps\r\n> = (props) => {\r\n\tconst { children, ...rest } = props;\r\n\r\n\treturn (\r\n\t\t<Typography\r\n\t\t\tpadding={1.5}\r\n\t\t\t{...rest}\r\n\t\t\tsx={{\r\n\t\t\t\tfontFamily: \"Fira Code\",\r\n\t\t\t\twordBreak: \"break-word\",\r\n\t\t\t\tfontVariantLigatures: \"contextual\",\r\n\t\t\t\t...rest.sx,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{children ?? \"-\"}\r\n\t\t</Typography>\r\n\t);\r\n};\r\n\r\ntype DiagramProcessProps = {\r\n\tbodyTokens?: DiagramToken[];\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nconst DiagramProcess: FC<DiagramProcessProps> = (\r\n\tprops,\r\n) => {\r\n\tconst { bodyTokens, ...rest } = props;\r\n\r\n\tlet bodyText: string | undefined = undefined;\r\n\tif (bodyTokens !== undefined) {\r\n\t\tbodyText = bodyTokens\r\n\t\t\t.map((token) => token.text)\r\n\t\t\t.join(\"\")\r\n\t\t\t.trim();\r\n\t\tif (bodyText.length === 0) {\r\n\t\t\tbodyText = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DiagramWrapper {...rest}>\r\n\t\t\t<DiagramComponentText>\r\n\t\t\t\t{bodyText}\r\n\t\t\t</DiagramComponentText>\r\n\t\t</DiagramWrapper>\r\n\t);\r\n};\r\n\r\ntype DiagramLoopFirstProps = {\r\n\tconditionTokens?: DiagramToken[];\r\n\tbody: DiagramNode[];\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nexport const DiagramLoopFirst: FC<\r\n\tDiagramLoopFirstProps\r\n> = (props) => {\r\n\tconst { conditionTokens, body, ...rest } =\r\n\t\tprops;\r\n\r\n\tlet conditionText: string | undefined =\r\n\t\tundefined;\r\n\tif (\r\n\t\tconditionTokens !== undefined &&\r\n\t\tconditionTokens.length > 0\r\n\t) {\r\n\t\tconditionText = conditionTokens\r\n\t\t\t.map((token) => token.text)\r\n\t\t\t.join(\"\")\r\n\t\t\t.trim();\r\n\t}\r\n\tlet bodyNode: ReactNode | ReactNode[] = (\r\n\t\t<DiagramProcess\r\n\t\t\tborderTop\r\n\t\t\tborderLeft\r\n\t\t/>\r\n\t);\r\n\tif (body.length > 0) {\r\n\t\tbodyNode = body.map((subnode, index) => (\r\n\t\t\t<Diagram\r\n\t\t\t\tkey={`subnode-${index}`}\r\n\t\t\t\tborderTop\r\n\t\t\t\tborderLeft\r\n\t\t\t\tnode={subnode}\r\n\t\t\t/>\r\n\t\t));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DiagramWrapper {...rest}>\r\n\t\t\t<DiagramComponentText>\r\n\t\t\t\t{conditionText}\r\n\t\t\t</DiagramComponentText>\r\n\t\t\t<Box paddingLeft={2}>{bodyNode}</Box>\r\n\t\t</DiagramWrapper>\r\n\t);\r\n};\r\n\r\ntype DiagramLoopLastProps = {\r\n\tconditionTokens?: DiagramToken[];\r\n\tbody: DiagramNode[];\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nexport const DiagramLoopLast: FC<\r\n\tDiagramLoopLastProps\r\n> = (props) => {\r\n\tconst { conditionTokens, body, ...rest } =\r\n\t\tprops;\r\n\r\n\tlet conditionText: string | undefined =\r\n\t\tundefined;\r\n\tif (\r\n\t\tconditionTokens !== undefined &&\r\n\t\tconditionTokens.length > 0\r\n\t) {\r\n\t\tconditionText = conditionTokens\r\n\t\t\t.map((token) => token.text)\r\n\t\t\t.join(\"\")\r\n\t\t\t.trim();\r\n\t}\r\n\r\n\tlet bodyNode: ReactNode | ReactNode[] = (\r\n\t\t<DiagramProcess\r\n\t\t\tborderBottom\r\n\t\t\tborderLeft\r\n\t\t/>\r\n\t);\r\n\tif (body.length > 0) {\r\n\t\tbodyNode = body.map((subnode, index) => (\r\n\t\t\t<Diagram\r\n\t\t\t\tkey={`subnode-${index}`}\r\n\t\t\t\tnode={subnode}\r\n\t\t\t\tborderBottom\r\n\t\t\t\tborderLeft\r\n\t\t\t/>\r\n\t\t));\r\n\t}\r\n\treturn (\r\n\t\t<DiagramWrapper {...rest}>\r\n\t\t\t<Box paddingLeft={2}>{bodyNode}</Box>\r\n\t\t\t<DiagramComponentText>\r\n\t\t\t\t{conditionText}\r\n\t\t\t</DiagramComponentText>\r\n\t\t</DiagramWrapper>\r\n\t);\r\n};\r\n\r\ntype DiagramIfElseProps = {\r\n\tconditionTokens?: DiagramToken[];\r\n\tbodyIf: DiagramNode[];\r\n\tbodyElse: DiagramNode[];\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nexport const DiagramIfElse: FC<\r\n\tDiagramIfElseProps\r\n> = (props) => {\r\n\tconst {\r\n\t\tconditionTokens,\r\n\t\tbodyIf,\r\n\t\tbodyElse,\r\n\t\t...rest\r\n\t} = props;\r\n\r\n\tlet conditionText: string | undefined =\r\n\t\tundefined;\r\n\tif (\r\n\t\tconditionTokens !== undefined &&\r\n\t\tconditionTokens.length > 0\r\n\t) {\r\n\t\tconditionText = conditionTokens\r\n\t\t\t.map((token) => token.text)\r\n\t\t\t.join(\"\")\r\n\t\t\t.trim();\r\n\t}\r\n\r\n\tlet bodyNodeIf: ReactNode | ReactNode[] = (\r\n\t\t<DiagramProcess borderTop />\r\n\t);\r\n\tif (bodyIf.length > 0) {\r\n\t\tbodyNodeIf = bodyIf.map((subnode, index) => (\r\n\t\t\t<Diagram\r\n\t\t\t\tkey={`index-${index}`}\r\n\t\t\t\tborderTop\r\n\t\t\t\tnode={subnode}\r\n\t\t\t/>\r\n\t\t));\r\n\t}\r\n\r\n\tlet bodyNodeElse: ReactNode | ReactNode[] = (\r\n\t\t<DiagramProcess borderTop />\r\n\t);\r\n\tif (bodyElse.length > 0) {\r\n\t\tbodyNodeElse = bodyElse.map(\r\n\t\t\t(subnode, index) => (\r\n\t\t\t\t<Diagram\r\n\t\t\t\t\tkey={`index-${index}`}\r\n\t\t\t\t\tborderTop\r\n\t\t\t\t\tnode={subnode}\r\n\t\t\t\t/>\r\n\t\t\t),\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DiagramWrapper {...rest}>\r\n\t\t\t<Grid\r\n\t\t\t\tcontainer\r\n\t\t\t\theight=\"100%\"\r\n\t\t\t>\r\n\t\t\t\t<Grid\r\n\t\t\t\t\titem\r\n\t\t\t\t\txs={12}\r\n\t\t\t\t>\r\n\t\t\t\t\t<DiagramComponentText align=\"center\">\r\n\t\t\t\t\t\t{conditionText}\r\n\t\t\t\t\t</DiagramComponentText>\r\n\t\t\t\t</Grid>\r\n\t\t\t\t<Grid\r\n\t\t\t\t\titem\r\n\t\t\t\t\txs={6}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Box\r\n\t\t\t\t\t\theight=\"100%\"\r\n\t\t\t\t\t\tdisplay=\"flex\"\r\n\t\t\t\t\t\talignItems=\"center\"\r\n\t\t\t\t\t\tjustifyContent=\"center\"\r\n\t\t\t\t\t\tposition=\"relative\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<DiagramComponentText\r\n\t\t\t\t\t\t\tsx={{\r\n\t\t\t\t\t\t\t\tzIndex: 2,\r\n\t\t\t\t\t\t\t\tbackgroundColor: grey[300],\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tTrue\r\n\t\t\t\t\t\t</DiagramComponentText>\r\n\t\t\t\t\t\t<ArrowTopLeftBottomRight htmlColor=\"black\" />\r\n\t\t\t\t\t</Box>\r\n\t\t\t\t</Grid>\r\n\t\t\t\t<Grid\r\n\t\t\t\t\titem\r\n\t\t\t\t\txs={6}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Box\r\n\t\t\t\t\t\theight=\"100%\"\r\n\t\t\t\t\t\tdisplay=\"flex\"\r\n\t\t\t\t\t\talignItems=\"center\"\r\n\t\t\t\t\t\tjustifyContent=\"center\"\r\n\t\t\t\t\t\tposition=\"relative\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<ArrowBottomLeftTopRight />\r\n\t\t\t\t\t\t<DiagramComponentText\r\n\t\t\t\t\t\t\tsx={{\r\n\t\t\t\t\t\t\t\tzIndex: 2,\r\n\t\t\t\t\t\t\t\tbackgroundColor: grey[300],\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tFalse\r\n\t\t\t\t\t\t</DiagramComponentText>\r\n\t\t\t\t\t</Box>\r\n\t\t\t\t</Grid>\r\n\t\t\t\t<Grid\r\n\t\t\t\t\titem\r\n\t\t\t\t\txs={6}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Stack\r\n\t\t\t\t\t\theight=\"100%\"\r\n\t\t\t\t\t\tsx={{\r\n\t\t\t\t\t\t\tborderColor: \"inherit\",\r\n\t\t\t\t\t\t\tborderRightStyle: \"solid\",\r\n\t\t\t\t\t\t\tborderRightWidth: 2,\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{bodyNodeIf}\r\n\t\t\t\t\t</Stack>\r\n\t\t\t\t</Grid>\r\n\t\t\t\t<Grid\r\n\t\t\t\t\titem\r\n\t\t\t\t\txs={6}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Stack height=\"100%\">\r\n\t\t\t\t\t\t{bodyNodeElse}\r\n\t\t\t\t\t</Stack>\r\n\t\t\t\t</Grid>\r\n\t\t\t</Grid>\r\n\t\t</DiagramWrapper>\r\n\t);\r\n};\r\n\r\ntype DiagramFuncProps = {\r\n\tdeclarationTokens: DiagramToken[];\r\n\tbody: DiagramNode[];\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nconst DiagramFunc: FC<DiagramFuncProps> = (\r\n\tprops,\r\n) => {\r\n\tconst { declarationTokens, body, ...rest } =\r\n\t\tprops;\r\n\r\n\tlet declarationText: string | undefined =\r\n\t\tundefined;\r\n\tif (\r\n\t\tdeclarationTokens !== undefined &&\r\n\t\tdeclarationTokens.length > 0\r\n\t) {\r\n\t\tdeclarationText = declarationTokens\r\n\t\t\t.map((token) => token.text)\r\n\t\t\t.join(\"\")\r\n\t\t\t.trim();\r\n\t}\r\n\r\n\tlet bodyNode: ReactNode | ReactNode[] = (\r\n\t\t<DiagramProcess\r\n\t\t\tborderTop\r\n\t\t\tborderLeft\r\n\t\t\tborderRight\r\n\t\t/>\r\n\t);\r\n\tif (body.length > 0) {\r\n\t\tbodyNode = body.map((subnode, index) => (\r\n\t\t\t<Diagram\r\n\t\t\t\tkey={`subnode-${index}`}\r\n\t\t\t\tnode={subnode}\r\n\t\t\t\tborderTop\r\n\t\t\t\tborderLeft\r\n\t\t\t\tborderRight\r\n\t\t\t/>\r\n\t\t));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DiagramWrapper {...rest}>\r\n\t\t\t<DiagramComponentText align=\"center\">\r\n\t\t\t\t{declarationText}\r\n\t\t\t</DiagramComponentText>\r\n\t\t\t<Box paddingX={2}>{bodyNode}</Box>\r\n\t\t</DiagramWrapper>\r\n\t);\r\n};\r\n\r\ntype DiagramErrorProps = {\r\n\tcontext: string;\r\n\treason: string;\r\n\tlineNumber: number;\r\n\tcharNumber: number;\r\n\tcaretOffset: number;\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nconst DiagramError: FC<DiagramErrorProps> = (\r\n\tprops,\r\n) => {\r\n\tconst {\r\n\t\tcontext,\r\n\t\treason,\r\n\t\tlineNumber,\r\n\t\tcharNumber,\r\n\t\tcaretOffset,\r\n\r\n\t\t...rest\r\n\t} = props;\r\n\tconst errorText = `At line ${lineNumber}, character ${charNumber}: ${reason}`;\r\n\tconst caretText = \"~\".repeat(caretOffset) + \"^\";\r\n\r\n\treturn (\r\n\t\t<DiagramWrapper {...rest}>\r\n\t\t\t<DiagramComponentText>\r\n\t\t\t\t{errorText}\r\n\t\t\t</DiagramComponentText>\r\n\t\t\t<DiagramComponentText paddingY={0}>\r\n\t\t\t\t{context}\r\n\t\t\t</DiagramComponentText>\r\n\t\t\t<DiagramComponentText paddingY={0}>\r\n\t\t\t\t{caretText}\r\n\t\t\t</DiagramComponentText>\r\n\t\t</DiagramWrapper>\r\n\t);\r\n};\r\n\r\ntype DiagramProps = {\r\n\tnode: DiagramNode;\r\n\r\n\tborderTop?: boolean;\r\n\tborderBottom?: boolean;\r\n\tborderRight?: boolean;\r\n\tborderLeft?: boolean;\r\n};\r\nexport const Diagram: FC<DiagramProps> = (\r\n\tprops,\r\n) => {\r\n\tconst { node, ...rest } = props;\r\n\r\n\tswitch (node.kind) {\r\n\t\tcase DiagramNodeKind.ERROR:\r\n\t\t\treturn (\r\n\t\t\t\t<DiagramError\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t\tcaretOffset={node.caretOffset}\r\n\t\t\t\t\tcontext={node.context}\r\n\t\t\t\t\treason={node.reason}\r\n\t\t\t\t\tlineNumber={node.lineNumber}\r\n\t\t\t\t\tcharNumber={node.charNumber}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\tcase DiagramNodeKind.FUNCTION:\r\n\t\t\treturn (\r\n\t\t\t\t<DiagramFunc\r\n\t\t\t\t\tdeclarationTokens={node.declaration}\r\n\t\t\t\t\tbody={node.body}\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\tcase DiagramNodeKind.LOOP_FIRST:\r\n\t\t\treturn (\r\n\t\t\t\t<DiagramLoopFirst\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t\tconditionTokens={node.condition}\r\n\t\t\t\t\tbody={node.body}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\tcase DiagramNodeKind.LOOP_LAST:\r\n\t\t\treturn (\r\n\t\t\t\t<DiagramLoopLast\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t\tconditionTokens={node.condition}\r\n\t\t\t\t\tbody={node.body}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\tcase DiagramNodeKind.IF_ELSE:\r\n\t\t\treturn (\r\n\t\t\t\t<DiagramIfElse\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t\tconditionTokens={node.condition}\r\n\t\t\t\t\tbodyIf={node.bodyIf}\r\n\t\t\t\t\tbodyElse={node.bodyElse}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\tcase DiagramNodeKind.PROCESS:\r\n\t\t\treturn (\r\n\t\t\t\t<DiagramProcess\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t\tbodyTokens={node.body}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t}\r\n\treturn <Fragment />;\r\n};\r\n","import { FC, ReactNode } from \"react\";\r\n\r\nimport {\r\n\tBox,\r\n\tSxProps,\r\n\tTypography,\r\n} from \"@mui/material\";\r\nimport { grey } from \"@mui/material/colors\";\r\n\r\nimport { DiagramNode } from \"interpreter\";\r\nimport { Diagram } from \"App/components/Diagram/Diagram\";\r\n\r\ntype DiagramPreviewProps = {\r\n\tnodes: DiagramNode[];\r\n\tid: string;\r\n\tboxProps: SxProps;\r\n};\r\nexport const DiagramPreview: FC<\r\n\tDiagramPreviewProps\r\n> = (props): ReactNode => {\r\n\tconst { nodes, id, boxProps } = props;\r\n\r\n\tlet component: ReactNode | ReactNode[] = (\r\n\t\t<Typography\r\n\t\t\tfontFamily=\"Fira Code\"\r\n\t\t\tfontStyle=\"italic\"\r\n\t\t>\r\n\t\t\tNothing to display.\r\n\t\t</Typography>\r\n\t);\r\n\tif (nodes.length > 0) {\r\n\t\tcomponent = nodes.map((node, index) => (\r\n\t\t\t<Diagram\r\n\t\t\t\tkey={`top-level-node-${index}`}\r\n\t\t\t\tnode={node}\r\n\t\t\t\tborderLeft\r\n\t\t\t\tborderTop\r\n\t\t\t\tborderRight\r\n\t\t\t\tborderBottom={index === nodes.length - 1}\r\n\t\t\t/>\r\n\t\t));\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Box\r\n\t\t\tsx={{\r\n\t\t\t\t...boxProps,\r\n\t\t\t\tbackgroundColor: grey[300],\r\n\t\t\t\tborderColor: grey[700],\r\n\t\t\t\theight: \"100%\",\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Box\r\n\t\t\t\tid={id}\r\n\t\t\t\tsx={{\r\n\t\t\t\t\tmaxWidth: \"640px\",\r\n\t\t\t\t\tbackgroundColor: grey[300],\r\n\t\t\t\t\tborderColor: grey[700],\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t{component}\r\n\t\t\t</Box>\r\n\t\t</Box>\r\n\t);\r\n};\r\n","import { FC } from \"react\";\r\n\r\nimport ReactCodeMirror, {\r\n\tEditorView,\r\n} from \"@uiw/react-codemirror\";\r\n\r\nimport \"./styles.css\";\r\n\r\ntype StyledCodeEditorProps = {\r\n\tvalue: string;\r\n\tonValueChange: (value: string) => void;\r\n};\r\nexport const StyledCodeEditor: FC<\r\n\tStyledCodeEditorProps\r\n> = (props) => {\r\n\tconst { value, onValueChange } = props;\r\n\r\n\treturn (\r\n\t\t<ReactCodeMirror\r\n\t\t\tvalue={value}\r\n\t\t\tonChange={onValueChange}\r\n\t\t\ttheme=\"dark\"\r\n\t\t\textensions={[EditorView.lineWrapping]}\r\n\t\t/>\r\n\t);\r\n};\r\n","import { FC } from \"react\";\r\nimport {\r\n\tButton,\r\n\tButtonProps,\r\n\tTooltip,\r\n} from \"@mui/material\";\r\n\r\ntype AdaptiveButtonProps = ButtonProps & {\r\n\tcollapsed: boolean;\r\n};\r\nexport const AdaptiveButton: FC<\r\n\tAdaptiveButtonProps\r\n> = (props) => {\r\n\tconst { collapsed, ...rest } = props;\r\n\r\n\tif (collapsed) {\r\n\t\treturn (\r\n\t\t\t<Tooltip title={rest.children}>\r\n\t\t\t\t<Button\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t\tstartIcon={undefined}\r\n\t\t\t\t\tendIcon={undefined}\r\n\t\t\t\t>\r\n\t\t\t\t\t{rest.startIcon}\r\n\t\t\t\t\t{rest.endIcon}\r\n\t\t\t\t</Button>\r\n\t\t\t</Tooltip>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Button\r\n\t\t\t{...rest}\r\n\t\t\tstartIcon={rest.startIcon}\r\n\t\t\tendIcon={rest.endIcon}\r\n\t\t>\r\n\t\t\t{rest.children}\r\n\t\t</Button>\r\n\t);\r\n};\r\n","import {\r\n\tFC,\r\n\tReactNode,\r\n\tuseEffect,\r\n\tuseRef,\r\n\tuseState,\r\n} from \"react\";\r\nimport {\r\n\tBox,\r\n\tGrid,\r\n\tStack,\r\n\tPaper,\r\n\tButton,\r\n\tuseMediaQuery,\r\n\tTheme,\r\n\tButtonGroup,\r\n} from \"@mui/material\";\r\nimport { getPreviewState } from \"App/components/LiveEditor/helper\";\r\nimport { LaunchRounded } from \"@mui/icons-material\";\r\n\r\ntype LayoutProps = {\r\n\tslotAppBar: ReactNode;\r\n\tslotPanelRight: ReactNode;\r\n\tslotPanelLeft: ReactNode;\r\n};\r\nexport const Layout: FC<LayoutProps> = (\r\n\tprops,\r\n) => {\r\n\tconst {\r\n\t\tslotAppBar,\r\n\t\tslotPanelLeft,\r\n\t\tslotPanelRight,\r\n\t} = props;\r\n\r\n\tconst appBarRef = useRef<HTMLDivElement | null>(\r\n\t\tnull,\r\n\t);\r\n\tconst [\r\n\t\tappBarStaticHeight,\r\n\t\tsetAppBarStaticHeight,\r\n\t] = useState(0);\r\n\r\n\tconst [previewOpen, setPreviewOpen] = useState(\r\n\t\tgetPreviewState(window.location.href),\r\n\t);\r\n\tconst handlePreviewToggle = () => {\r\n\t\tsetPreviewOpen((prev) => !prev);\r\n\t};\r\n\r\n\tconst matchBreakpointXs = useMediaQuery<Theme>(\r\n\t\t(theme) => theme.breakpoints.down(\"md\"),\r\n\t);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (appBarRef.current === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsetAppBarStaticHeight(\r\n\t\t\tappBarRef.current.getBoundingClientRect()\r\n\t\t\t\t.height,\r\n\t\t);\r\n\t}, [appBarRef]);\r\n\r\n\treturn (\r\n\t\t<Box>\r\n\t\t\t<Paper\r\n\t\t\t\tref={appBarRef}\r\n\t\t\t\tsquare\r\n\t\t\t\televation={0}\r\n\t\t\t\tsx={{\r\n\t\t\t\t\tpadding: 1,\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<Stack\r\n\t\t\t\t\tdisplay=\"flex\"\r\n\t\t\t\t\tdirection=\"row\"\r\n\t\t\t\t\tjustifyContent=\"space-between\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<ButtonGroup variant=\"outlined\">\r\n\t\t\t\t\t\t<Button onClick={handlePreviewToggle}>\r\n\t\t\t\t\t\t\t{previewOpen\r\n\t\t\t\t\t\t\t\t? \"Show code\"\r\n\t\t\t\t\t\t\t\t: \"Hide code\"}\r\n\t\t\t\t\t\t</Button>{\" \"}\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\thref=\"https://eurydia.github.io/project-nassi-shneiderman-diagram-builder-online-docs/\"\r\n\t\t\t\t\t\t\tcomponent=\"a\"\r\n\t\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\t\tendIcon={<LaunchRounded />}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tdocs\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</ButtonGroup>\r\n\t\t\t\t\t{slotAppBar}\r\n\t\t\t\t</Stack>\r\n\t\t\t</Paper>\r\n\t\t\t<Box>\r\n\t\t\t\t<Grid container>\r\n\t\t\t\t\t<Grid\r\n\t\t\t\t\t\titem\r\n\t\t\t\t\t\txs={12}\r\n\t\t\t\t\t\tlg={6}\r\n\t\t\t\t\t\tdisplay={\r\n\t\t\t\t\t\t\tpreviewOpen ? \"none\" : undefined\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Box\r\n\t\t\t\t\t\t\toverflow=\"auto\"\r\n\t\t\t\t\t\t\theight={`calc(100vh - ${appBarStaticHeight}px)`}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{slotPanelLeft}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t</Grid>\r\n\t\t\t\t\t<Grid\r\n\t\t\t\t\t\titem\r\n\t\t\t\t\t\txs\r\n\t\t\t\t\t\tlg\r\n\t\t\t\t\t\tdisplay={\r\n\t\t\t\t\t\t\tmatchBreakpointXs && !previewOpen\r\n\t\t\t\t\t\t\t\t? \"none\"\r\n\t\t\t\t\t\t\t\t: undefined\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Box\r\n\t\t\t\t\t\t\toverflow=\"auto\"\r\n\t\t\t\t\t\t\theight={`calc(100vh - ${appBarStaticHeight}px)`}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{slotPanelRight}\r\n\t\t\t\t\t\t</Box>\r\n\t\t\t\t\t</Grid>\r\n\t\t\t\t</Grid>\r\n\t\t\t</Box>\r\n\t\t</Box>\r\n\t);\r\n};\r\n","export const generateUniqueLink = (\r\n\teditorContent: string,\r\n\tlocationHref: string,\r\n) => {\r\n\tconst url = new URL(locationHref);\r\n\turl.searchParams.set(\"preview\", \"true\");\r\n\turl.searchParams.set(\"content\", editorContent);\r\n\treturn url.href;\r\n};\r\n\r\nexport const getPreviewState = (\r\n\tlocationHref: string,\r\n): boolean => {\r\n\tconst url = new URL(locationHref);\r\n\tconst previewParam =\r\n\t\turl.searchParams.get(\"preview\");\r\n\treturn (\r\n\t\tpreviewParam !== null &&\r\n\t\tpreviewParam === \"true\"\r\n\t);\r\n};\r\n","import {\r\n\tFC,\r\n\tFragment,\r\n\tuseEffect,\r\n\tuseState,\r\n} from \"react\";\r\n\r\nimport {\r\n\tPaper,\r\n\tMenuList,\r\n\tListItemText,\r\n\tButtonGroup,\r\n\tPopover,\r\n\tMenuItem,\r\n\tListItemIcon,\r\n\tTheme,\r\n\tuseMediaQuery,\r\n} from \"@mui/material\";\r\nimport {\r\n\tDownloadRounded,\r\n\tSendRounded,\r\n} from \"@mui/icons-material\";\r\nimport { useSnackbar } from \"notistack\";\r\n\r\nimport {\r\n\tlexerGetAllTokens,\r\n\tlexerInit,\r\n\tDiagramNode,\r\n\tparserGetAllNodes,\r\n\tparserInit,\r\n} from \"interpreter\";\r\n\r\nimport { DiagramPreview } from \"App/components/DiagramPreview\";\r\nimport { StyledCodeEditor } from \"App/components/StyledCodeEditor\";\r\nimport { AdaptiveButton } from \"App/components/AdaptiveButton\";\r\n\r\nimport { Layout } from \"./Layout\";\r\nimport { useExportDiagram } from \"./useExportDiagram\";\r\nimport { useEditorContent } from \"./useEditorContent\";\r\nimport { generateUniqueLink } from \"./helper\";\r\n\r\nexport const LiveEditor: FC = () => {\r\n\tconst { enqueueSnackbar } = useSnackbar();\r\n\tconst { exportJPEG, exportPNG, exportSVG } =\r\n\t\tuseExportDiagram(\r\n\t\t\t\"structogram-preview-region\",\r\n\t\t);\r\n\tconst { editorContent, setEditorContent } =\r\n\t\tuseEditorContent(\r\n\t\t\twindow.location.href,\r\n\t\t\t\"autosaveContent\",\r\n\t\t);\r\n\tconst matchBreakpointXs = useMediaQuery<Theme>(\r\n\t\t(theme) => theme.breakpoints.down(\"md\"),\r\n\t);\r\n\r\n\tconst [nodes, setNodes] = useState<\r\n\t\tDiagramNode[]\r\n\t>([]);\r\n\tconst [\r\n\t\tpopoverExportMenuAnchor,\r\n\t\tsetPopoverExportMenuAnchor,\r\n\t] = useState<HTMLButtonElement | null>(null);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst tokens = lexerGetAllTokens(\r\n\t\t\tlexerInit(editorContent),\r\n\t\t);\r\n\t\tconst nodes = parserGetAllNodes(\r\n\t\t\tparserInit(tokens),\r\n\t\t);\r\n\t\tsetNodes(nodes);\r\n\t}, [editorContent]);\r\n\r\n\tconst handleCopyLink = () => {\r\n\t\tnavigator.clipboard.writeText(\r\n\t\t\tgenerateUniqueLink(\r\n\t\t\t\teditorContent,\r\n\t\t\t\twindow.location.href,\r\n\t\t\t),\r\n\t\t);\r\n\t\tenqueueSnackbar(\"Link copied to clipboard\", {\r\n\t\t\tvariant: \"info\",\r\n\t\t});\r\n\t};\r\n\r\n\tconst handlePopoverExportMenuOpen = (\r\n\t\tevent: React.MouseEvent<HTMLButtonElement>,\r\n\t) => {\r\n\t\tsetPopoverExportMenuAnchor(\r\n\t\t\tevent.currentTarget,\r\n\t\t);\r\n\t};\r\n\tconst handlePopoverExportMenuClose = () => {\r\n\t\tsetPopoverExportMenuAnchor(null);\r\n\t};\r\n\r\n\tconst handleExportDiagram = async (\r\n\t\texporterFn: () => Promise<boolean>,\r\n\t) => {\r\n\t\texporterFn().then((success) => {\r\n\t\t\tif (success) {\r\n\t\t\t\tenqueueSnackbar(\"Diagram exported\", {\r\n\t\t\t\t\tvariant: \"info\",\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tenqueueSnackbar(\r\n\t\t\t\t\"Failed to export diagram\",\r\n\t\t\t\t{\r\n\t\t\t\t\tvariant: \"error\",\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<Layout\r\n\t\t\t\tslotAppBar={\r\n\t\t\t\t\t<ButtonGroup variant=\"outlined\">\r\n\t\t\t\t\t\t<AdaptiveButton\r\n\t\t\t\t\t\t\tcollapsed={matchBreakpointXs}\r\n\t\t\t\t\t\t\tstartIcon={<DownloadRounded />}\r\n\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\thandlePopoverExportMenuOpen\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tEXPORT\r\n\t\t\t\t\t\t</AdaptiveButton>\r\n\t\t\t\t\t\t<AdaptiveButton\r\n\t\t\t\t\t\t\tcollapsed={matchBreakpointXs}\r\n\t\t\t\t\t\t\tendIcon={<SendRounded />}\r\n\t\t\t\t\t\t\tonClick={handleCopyLink}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tSHARE\r\n\t\t\t\t\t\t</AdaptiveButton>\r\n\t\t\t\t\t</ButtonGroup>\r\n\t\t\t\t}\r\n\t\t\t\tslotPanelLeft={\r\n\t\t\t\t\t<StyledCodeEditor\r\n\t\t\t\t\t\tvalue={editorContent}\r\n\t\t\t\t\t\tonValueChange={setEditorContent}\r\n\t\t\t\t\t/>\r\n\t\t\t\t}\r\n\t\t\t\tslotPanelRight={\r\n\t\t\t\t\t<DiagramPreview\r\n\t\t\t\t\t\tnodes={nodes}\r\n\t\t\t\t\t\tid=\"structogram-preview-region\"\r\n\t\t\t\t\t\tboxProps={{\r\n\t\t\t\t\t\t\tpadding: 4,\r\n\t\t\t\t\t\t\tuserSelect: \"none\",\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t}\r\n\t\t\t/>\r\n\t\t\t<Popover\r\n\t\t\t\tanchorOrigin={{\r\n\t\t\t\t\tvertical: \"bottom\",\r\n\t\t\t\t\thorizontal: \"left\",\r\n\t\t\t\t}}\r\n\t\t\t\ttransformOrigin={{\r\n\t\t\t\t\tvertical: \"top\",\r\n\t\t\t\t\thorizontal: \"left\",\r\n\t\t\t\t}}\r\n\t\t\t\tanchorEl={popoverExportMenuAnchor}\r\n\t\t\t\topen={popoverExportMenuAnchor !== null}\r\n\t\t\t\tonClose={handlePopoverExportMenuClose}\r\n\t\t\t>\r\n\t\t\t\t<Paper\r\n\t\t\t\t\tsx={{\r\n\t\t\t\t\t\tpadding: 1,\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<MenuList>\r\n\t\t\t\t\t\t<MenuItem\r\n\t\t\t\t\t\t\tonClick={() =>\r\n\t\t\t\t\t\t\t\thandleExportDiagram(exportJPEG)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<ListItemIcon>\r\n\t\t\t\t\t\t\t\t<DownloadRounded fontSize=\"small\" />\r\n\t\t\t\t\t\t\t</ListItemIcon>\r\n\t\t\t\t\t\t\t<ListItemText>\r\n\t\t\t\t\t\t\t\tSave as JPEG\r\n\t\t\t\t\t\t\t</ListItemText>\r\n\t\t\t\t\t\t</MenuItem>\r\n\t\t\t\t\t\t<MenuItem\r\n\t\t\t\t\t\t\tonClick={() =>\r\n\t\t\t\t\t\t\t\thandleExportDiagram(exportPNG)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<ListItemIcon>\r\n\t\t\t\t\t\t\t\t<DownloadRounded fontSize=\"small\" />\r\n\t\t\t\t\t\t\t</ListItemIcon>\r\n\t\t\t\t\t\t\t<ListItemText>\r\n\t\t\t\t\t\t\t\tSave as PNG\r\n\t\t\t\t\t\t\t</ListItemText>\r\n\t\t\t\t\t\t</MenuItem>\r\n\t\t\t\t\t\t<MenuItem\r\n\t\t\t\t\t\t\tonClick={() =>\r\n\t\t\t\t\t\t\t\thandleExportDiagram(exportSVG)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<ListItemIcon>\r\n\t\t\t\t\t\t\t\t<DownloadRounded fontSize=\"small\" />\r\n\t\t\t\t\t\t\t</ListItemIcon>\r\n\t\t\t\t\t\t\t<ListItemText>\r\n\t\t\t\t\t\t\t\tSave as SVG\r\n\t\t\t\t\t\t\t</ListItemText>\r\n\t\t\t\t\t\t</MenuItem>\r\n\t\t\t\t\t</MenuList>\r\n\t\t\t\t</Paper>\r\n\t\t\t</Popover>\r\n\t\t</Fragment>\r\n\t);\r\n};\r\n","// Custom hooks for exporting diagrams\r\n\r\nimport { saveAs } from \"file-saver\";\r\nimport {\r\n\ttoJpeg,\r\n\ttoPng,\r\n\ttoSvg,\r\n} from \"html-to-image\";\r\n\r\nexport const useExportDiagram = (\r\n\ttargetElementId: string,\r\n) => {\r\n\tconst exportSVG = async () => {\r\n\t\tconst HTMLNode = document.getElementById(\r\n\t\t\ttargetElementId,\r\n\t\t);\r\n\t\tif (HTMLNode === null) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn toSvg(HTMLNode).then((blob) => {\r\n\t\t\tif (blob === null) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tsaveAs(blob, \"structogram\");\r\n\t\t\treturn true;\r\n\t\t});\r\n\t};\r\n\r\n\tconst exportPNG = async () => {\r\n\t\tconst HTMLNode = document.getElementById(\r\n\t\t\ttargetElementId,\r\n\t\t);\r\n\t\tif (HTMLNode === null) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn toPng(HTMLNode).then((blob) => {\r\n\t\t\tif (blob === null) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tsaveAs(blob, \"structogram\");\r\n\t\t\treturn true;\r\n\t\t});\r\n\t};\r\n\r\n\tconst exportJPEG = async () => {\r\n\t\tconst HTMLNode = document.getElementById(\r\n\t\t\ttargetElementId,\r\n\t\t);\r\n\t\tif (HTMLNode === null) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn toJpeg(HTMLNode).then((blob) => {\r\n\t\t\tif (blob === null) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tsaveAs(blob, \"structogram\");\r\n\t\t\treturn true;\r\n\t\t});\r\n\t};\r\n\r\n\treturn {\r\n\t\texportSVG,\r\n\t\texportJPEG,\r\n\t\texportPNG,\r\n\t};\r\n};\r\n","// Custom hook for editor content\r\n\r\nimport { useState } from \"react\";\r\n\r\nexport const useEditorContent = (\r\n\threfURL: string,\r\n\tlocalStorageKey: string,\r\n) => {\r\n\tconst [editorContent, setEditorContentInner] =\r\n\t\tuseState(() => {\r\n\t\t\tconst url = new URL(hrefURL);\r\n\r\n\t\t\tconst content =\r\n\t\t\t\turl.searchParams.get(\"content\");\r\n\t\t\tif (content !== null) {\r\n\t\t\t\twindow.localStorage.setItem(\r\n\t\t\t\t\tlocalStorageKey,\r\n\t\t\t\t\tcontent,\r\n\t\t\t\t);\r\n\t\t\t\treturn content;\r\n\t\t\t}\r\n\r\n\t\t\tconst savedContent =\r\n\t\t\t\twindow.localStorage.getItem(\r\n\t\t\t\t\tlocalStorageKey,\r\n\t\t\t\t);\r\n\t\t\tif (savedContent !== null) {\r\n\t\t\t\treturn savedContent;\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t});\r\n\r\n\tconst setEditorContent = (content: string) => {\r\n\t\tsetEditorContentInner(content);\r\n\t\twindow.localStorage.setItem(\r\n\t\t\tlocalStorageKey,\r\n\t\t\tcontent,\r\n\t\t);\r\n\t};\r\n\r\n\treturn { editorContent, setEditorContent };\r\n};\r\n","import { Fragment, FC } from \"react\";\r\nimport {\r\n\tCssBaseline,\r\n\tThemeProvider,\r\n\tcreateTheme,\r\n} from \"@mui/material\";\r\n\r\nimport { SnackbarProvider } from \"notistack\";\r\n\r\nimport { LiveEditor } from \"App/components/LiveEditor/LiveEditor\";\r\n\r\nconst themeDark = createTheme({\r\n\tpalette: {\r\n\t\tmode: \"dark\",\r\n\t},\r\n});\r\n\r\nexport const App: FC = () => {\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<CssBaseline />\r\n\t\t\t<ThemeProvider theme={themeDark}>\r\n\t\t\t\t<SnackbarProvider\r\n\t\t\t\t\tpreventDuplicate\r\n\t\t\t\t\tautoHideDuration={2000}\r\n\t\t\t\t\tanchorOrigin={{\r\n\t\t\t\t\t\tvertical: \"top\",\r\n\t\t\t\t\t\thorizontal: \"center\",\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<LiveEditor />\r\n\t\t\t\t</SnackbarProvider>\r\n\t\t\t</ThemeProvider>\r\n\t\t</Fragment>\r\n\t);\r\n};\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom/client\";\r\n\r\nimport { App } from \"./App\";\r\n\r\nReactDOM.createRoot(\r\n\tdocument.getElementById(\"root\")!,\r\n).render(\r\n\t<React.StrictMode>\r\n\t\t<App />\r\n\t</React.StrictMode>,\r\n);\r\n"],"names":["DiagramTokenKind","DiagramTokenKind2","KEYWORDS","LITERAL_TOKENS","lexerGetNextTokenThenAdvance","l","token","kind","text","lineNumber","charNumber","cursorPos","contentLength","content","test","includes","DiagramNodeKind","DiagramNodeKind2","parserInit","tokens","tokenLength","length","parserCollectTokensBetween","p","startToken","stopToken","depth","push","parserSkipWhiteSpace","WHITE_SPACE","buildMissingTokenError","markerToken","at","missingToken","reason","context","caretOffset","buildUnexpectedTokenError","errorToken","expectedToken","markerTokenText","errorTokenText","parserGetNextNodeThenAdvance","KEYWORD","node","body","condition","LEFT_PAREN","RIGHT_PAREN","pop","LEFT_CURLY","bodyTokens","RIGHT_CURLY","parserGetAllNodes","parserBuildLoopFirstNode","SEMICOLON","parserBuildLoopLastNode","bodyIf","bodyElse","bodyIfTokens","bodyElseTokens","parserBuildIfElseNode","declaration","nodes","ArrowTopLeftBottomRight","props","sx","jsxRuntimeExports","jsx","SvgIcon","position","width","height","children","xmlns","preserveAspectRatio","fill","viewBox","strokeWidth","x1","y1","x2","y2","stroke","strokeLinecap","ArrowBottomLeftTopRight","DiagramWrapper","borderTop","borderBottom","borderLeft","borderRight","Box","borderStyle","borderLeftWidth","borderTopWidth","borderBottomWidth","borderRightWidth","DiagramComponentText","rest","Typography","padding","fontFamily","wordBreak","fontVariantLigatures","DiagramProcess","bodyText","map","join","trim","DiagramLoopFirst","conditionTokens","conditionText","bodyNode","subnode","index","Diagram","jsxs","paddingLeft","DiagramLoopLast","DiagramIfElse","bodyNodeIf","bodyNodeElse","Grid","container","item","xs","align","display","alignItems","justifyContent","zIndex","backgroundColor","grey","htmlColor","Stack","borderColor","borderRightStyle","DiagramFunc","declarationTokens","declarationText","paddingX","DiagramError","errorText","caretText","repeat","paddingY","ERROR","FUNCTION","LOOP_FIRST","LOOP_LAST","IF_ELSE","PROCESS","Fragment","DiagramPreview","id","boxProps","component","fontStyle","maxWidth","StyledCodeEditor","value","onValueChange","ReactCodeMirror","onChange","theme","extensions","EditorView","lineWrapping","AdaptiveButton","collapsed","Tooltip","title","Button","startIcon","endIcon","Layout","slotAppBar","slotPanelLeft","slotPanelRight","appBarRef","useRef","appBarStaticHeight","setAppBarStaticHeight","useState","previewOpen","setPreviewOpen","locationHref","previewParam","URL","searchParams","get","getPreviewState","window","location","href","matchBreakpointXs","useMediaQuery","breakpoints","down","useEffect","current","getBoundingClientRect","Paper","ref","square","elevation","direction","ButtonGroup","variant","onClick","prev","target","LaunchRounded","lg","overflow","LiveEditor","enqueueSnackbar","useSnackbar","exportJPEG","exportPNG","exportSVG","targetElementId","async","HTMLNode","document","getElementById","toSvg","then","blob","toJpeg","toPng","editorContent","setEditorContent","hrefURL","localStorageKey","setEditorContentInner","localStorage","setItem","savedContent","getItem","useEditorContent","setNodes","popoverExportMenuAnchor","setPopoverExportMenuAnchor","lexerGetAllTokens","cleanedContent","cleanContent","contentPos","removeComments","normalize","lexerInit","handleExportDiagram","exporterFn","success","DownloadRounded","event","currentTarget","SendRounded","navigator","clipboard","writeText","url","set","generateUniqueLink","userSelect","Popover","anchorOrigin","vertical","horizontal","transformOrigin","anchorEl","open","onClose","MenuList","MenuItem","ListItemIcon","fontSize","ListItemText","themeDark","createTheme","palette","mode","App","CssBaseline","ThemeProvider","SnackbarProvider","preventDuplicate","autoHideDuration","ReactDOM","createRoot","render","React","StrictMode"],"mappings":"4kCAAY,IAAAA,GAAAA,IACXA,EAAAA,MAAM,GAAN,MACAA,EAAAC,EAAA,OAAA,GAAA,SACAD,EAAAC,EAAA,QAAA,GAAA,UAEAD,EAAAC,EAAA,WAAA,GAAA,aACAD,EAAAC,EAAA,YAAA,GAAA,cACAD,EAAAC,EAAA,WAAA,GAAA,aACAD,EAAAC,EAAA,YAAA,GAAA,cACAD,EAAAC,EAAA,UAAA,GAAA,YACAD,EAAAC,EAAA,YAAA,GAAA,cAVWD,IAAAA,GAAA,CAAA,GAoBZ,MAAME,EAAqB,CAC1B,MACA,KACA,OACA,QACA,MAGKC,EAGF,CACH,IAAK,EACL,IAAK,EACL,IAAK,EACL,IAAK,EACL,IAAK,GAsDOC,EACZC,IAEA,MAAMC,EAAsB,CAC3BC,KAAM,EACNC,KAAM,GACNC,WAAYJ,EAAEI,WACdC,WAAYL,EAAEK,YAGX,GAAAL,EAAEM,WAAaN,EAAEO,cACb,OAAAN,EAOR,GAJAA,EAAME,KAAOH,EAAEQ,QAAQR,EAAEM,WACvBN,EAAAM,YACAN,EAAAK,aAEE,KAAKI,KAAKR,EAAME,MAMZ,OALPF,EAAMC,KAAO,EACM,OAAfD,EAAME,OACPH,EAAAI,aACFJ,EAAEK,WAAa,GAETJ,EAGJ,GAAAA,EAAME,QAAQL,EAEV,OADDG,EAAAC,KAAOJ,EAAeG,EAAME,MAC3BF,EAGR,KACCD,EAAEM,UAAYN,EAAEO,iBACdP,EAAEQ,QAAQR,EAAEM,aAAcR,KAC3B,KAAKW,KAAKT,EAAEQ,QAAQR,EAAEM,aAEvBL,EAAME,MAAQH,EAAEQ,QAAQR,EAAEM,WACxBN,EAAAM,YACAN,EAAAK,aAGH,OAAIR,EAASa,SAAST,EAAME,OAC3BF,EAAMC,KAAO,EACND,IAGRA,EAAMC,KAAO,EACND,EAAA,ECrII,IAAAU,GAAAA,IACXA,EAAAA,MAAM,GAAN,MACAA,EAAAC,EAAA,MAAA,GAAA,QACAD,EAAAC,EAAA,QAAA,GAAA,UACAD,EAAAC,EAAA,WAAA,GAAA,aACAD,EAAAC,EAAA,UAAA,GAAA,YACAD,EAAAC,EAAA,QAAA,GAAA,UACAD,EAAAC,EAAA,SAAA,GAAA,WAPWD,IAAAA,GAAA,CAAA,GAoEC,MAAAE,EACZC,IAEO,CACNA,SACAC,YAAaD,EAAOE,OACpBV,UAAW,IAIPW,EAA6B,CAClCC,EACAC,EACAC,KAEI,GAAAF,EAAEZ,WAAaY,EAAEH,YACpB,MAAO,GAER,GAAIG,EAAEJ,OAAOI,EAAEZ,WAAWJ,OAASiB,EAClC,MAAO,GAGND,EAAAZ,YAGF,MAAMQ,EAAyB,GAE/B,IACIb,EADAoB,GAAQ,EAEL,KAAAH,EAAEZ,UAAYY,EAAEH,cACdd,EAAAiB,EAAEJ,OAAOI,EAAEZ,WACjBY,EAAAZ,YACEL,EAAMC,OAASiB,GAClBE,IAEGpB,EAAMC,OAASkB,GAClBC,IAEDP,EAAOQ,KAAKrB,GAEE,IAAVoB,KAME,OAAAP,CAAA,EAGFS,EACLL,IAGC,KAAAA,EAAEZ,UAAYY,EAAEH,aAChBG,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACrBP,EAAiB6B,aAEhBN,EAAAZ,WACH,EAGKmB,EAAyB,CAC9BC,EACAC,EACAC,KAEA,MAAMzB,KAAEA,EAAAC,WAAMA,EAAYC,WAAAA,GACzBqB,EAEM,MAAA,CACNxB,KAAM,EACN2B,OAHc,cAAcF,6BAA8BC,YAI1DE,QAAS3B,EACT4B,YAAa5B,EAAKa,OAClBZ,aACAC,aAAA,EAII2B,EAA4B,CACjCN,EACAO,EACAN,EACAO,KAEM,MAAE/B,KAAMgC,GAAoBT,GAEjCvB,KAAMiC,EAAAhC,WACNA,EAAAC,WACAA,GACG4B,EAEG,MAAA,CACN/B,KAAM,EACN2B,OAHc,6BAA6BF,8BAA+BO,uBAAmCE,cAI7GN,QAAS,GAAGK,KAAmBC,IAC/BL,YAAaI,EAAgBnB,OAAS,EACtCZ,aACAC,aAAA,EAyfIgC,EACLnB,IAGI,GADJK,EAAqBL,GACjBA,EAAEZ,WAAaY,EAAEH,YACb,MAAA,CACNb,KAAM,GAGR,MAAMD,EAAQiB,EAAEJ,OAAOI,EAAEZ,WAErB,GADFY,EAAAZ,YACEL,EAAMC,OAASP,EAAiB2C,QACnC,OAAQrC,EAAME,MACb,IAAK,MACL,IAAK,QACJ,MApgB6B,CAChCe,IAEA,MAAMqB,EAA6B,CAClCrC,KAAM,EACNsC,KAAM,GACNC,UAAW,IAGZ,IAAIf,EACHR,EAAEJ,OAAOI,EAAEZ,UAAY,GAGpB,GAFJiB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACb,OAAAU,EACNC,EACA,kBACA,KAKF,GACCR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiB+C,WAEV,OAAAV,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,kBACA,KAoBF,GAhBcoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEzBiC,EAAKE,UAAYxB,EAChBC,EACAvB,EAAiB+C,WACjB/C,EAAiBgD,aAKdJ,EAAKE,UAAUzB,OAAS,IAC3BU,EACCa,EAAKE,UAAUF,EAAKE,UAAUzB,OAAS,IAKd,IAA1BuB,EAAKE,UAAUzB,QACfU,EAAYxB,OACXP,EAAiBgD,YAEX,OAAAlB,EACNC,EACA,kBACA,KAQE,GAJJa,EAAKE,UAAUG,MAEfrB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACb,OAAAU,EACNC,EACA,kBACA,KAKF,GACCR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiBkD,WAEV,OAAAb,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,kBACA,KAIYoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEzB,MAAMwC,EAAa7B,EAClBC,EACAvB,EAAiBkD,WACjBlD,EAAiBoD,aAYlB,OANID,EAAW9B,OAAS,IAEtBU,EAAAoB,EAAWA,EAAW9B,OAAS,IAKV,IAAtB8B,EAAW9B,QACXU,EAAYxB,OACXP,EAAiBoD,YAEXtB,EACNC,EACA,kBACA,MAIFoB,EAAWF,MAEXL,EAAKC,KAAOQ,EACXnC,EAAWiC,IAELP,EAAA,EA2YGU,CAAyB/B,GACjC,IAAK,KACJ,MA1Y4B,CAC/BA,IAEA,MAAMqB,EAA4B,CACjCrC,KAAM,EACNsC,KAAM,GACNC,UAAW,IAIZ,IAAIf,EAAcR,EAAEJ,OAAOI,EAAEZ,UAAY,GAIrC,GAFJiB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACb,OAAAU,EACNC,EACA,iBACA,KAKF,GACCR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiBkD,WAEV,OAAAb,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,iBACA,KAIYoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEzB,MAAMwC,EAAa7B,EAClBC,EACAvB,EAAiBkD,WACjBlD,EAAiBoD,aAYlB,OANID,EAAW9B,OAAS,IAEtBU,EAAAoB,EAAWA,EAAW9B,OAAS,IAKV,IAAtB8B,EAAW9B,QACXU,EAAYxB,OACXP,EAAiBoD,YAEXtB,EACNC,EACA,iBACA,MAIFoB,EAAWF,MAEXrB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACbU,EACNC,EACA,iBACA,SAMDR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACrBP,EAAiB2C,SACa,UAA/BpB,EAAEJ,OAAOI,EAAEZ,WAAWH,KAEf6B,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,iBACA,UAIYoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEvBY,EAAAZ,YACFiB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACbU,EACNC,EACA,iBACA,KAMDR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiB+C,WAEVV,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,iBACA,MAIYoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEzBiC,EAAKE,UAAYxB,EAChBC,EACAvB,EAAiB+C,WACjB/C,EAAiBgD,aAKdJ,EAAKE,UAAUzB,OAAS,IAC3BU,EACCa,EAAKE,UAAUF,EAAKE,UAAUzB,OAAS,IAKd,IAA1BuB,EAAKE,UAAUzB,QACfU,EAAYxB,OACXP,EAAiBgD,YAEXlB,EACNC,EACA,iBACA,MAIFa,EAAKE,UAAUG,MAEfrB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACbU,EACNC,EACA,iBACA,KAMDR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiBuD,UAEVlB,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,iBACA,MAIAY,EAAAZ,YAGFiC,EAAKC,KAAOQ,EACXnC,EAAWiC,IAELP,MAAA,EA2NGY,CAAwBjC,GAChC,IAAK,KACJ,MA1N0B,CAC7BA,IAEA,MAAMqB,EAA0B,CAC/BrC,KAAM,EACNuC,UAAW,GACXW,OAAQ,GACRC,SAAU,IAGX,IAAI3B,EACHR,EAAEJ,OAAOI,EAAEZ,UAAY,GAGpB,GAFJiB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACb,OAAAU,EACNC,EACA,uBACA,KAKF,GACCR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiB+C,WAEV,OAAAV,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,uBACA,KAmBF,GAfcoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WACzBiC,EAAKE,UAAYxB,EAChBC,EACAvB,EAAiB+C,WACjB/C,EAAiBgD,aAKdJ,EAAKE,UAAUzB,OAAS,IAC3BU,EACCa,EAAKE,UAAUF,EAAKE,UAAUzB,OAAS,IAKd,IAA1BuB,EAAKE,UAAUzB,QACfU,EAAYxB,OACXP,EAAiBgD,YAEX,OAAAlB,EACNC,EACA,uBACA,KAQE,GAJJa,EAAKE,UAAUG,MAEfrB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACb,OAAAU,EACNC,EACA,uBACA,KAKF,GACCR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiBkD,WAEV,OAAAb,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,uBACA,KAIYoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEzB,MAAMgD,EAAerC,EACpBC,EACAvB,EAAiBkD,WACjBlD,EAAiBoD,aAWlB,GANIO,EAAatC,OAAS,IAExBU,EAAA4B,EAAaA,EAAatC,OAAS,IAKZ,IAAxBsC,EAAatC,QACbU,EAAYxB,OACXP,EAAiBoD,YAEX,OAAAtB,EACNC,EACA,uBACA,KAcF,GAVA4B,EAAaV,MAIbL,EAAKa,OAASJ,EACbnC,EAAWyC,IAEZ/B,EAAqBL,GAIpBA,EAAEZ,WAAaY,EAAEH,aACjBG,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACrBP,EAAiB2C,SACa,SAA/BpB,EAAEJ,OAAOI,EAAEZ,WAAWH,KAEf,OAAAoC,EASJ,GALUb,EAAAR,EAAEJ,OAAOI,EAAEZ,WACvBY,EAAAZ,YAEFiB,EAAqBL,GAEjBA,EAAEZ,WAAaY,EAAEH,YACb,OAAAU,EACNC,EACA,4BACA,KAKF,GACCR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiBkD,WAEV,OAAAb,EACNN,EACAR,EAAEJ,OAAOI,EAAEZ,WACX,4BACA,KAIYoB,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEzB,MAAMiD,EACLtC,EACCC,EACAvB,EAAiBkD,WACjBlD,EAAiBoD,aAWnB,OANIQ,EAAevC,OAAS,IAE1BU,EAAA6B,EAAeA,EAAevC,OAAS,IAKd,IAA1BuC,EAAevC,QACfU,EAAYxB,OACXP,EAAiBoD,YAEXtB,EACNC,EACA,4BACA,MAIF6B,EAAeX,MAEfL,EAAKc,SAAWL,EACfnC,EAAW0C,IAGLhB,EAAA,EAsBGiB,CAAsBtC,GAM1B,MAAAJ,EAAyB,CAACb,GAChC,IAAIyB,EAAczB,EAGjB,GAAAyB,EAAYxB,OACZP,EAAiBuD,UAEV,MAAA,CACNhD,KAAM,EACNsC,KAAM,IAKR,KACCtB,EAAEZ,UAAYY,EAAEH,aAChBG,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACrBP,EAAiBuD,WAClBhC,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACrBP,EAAiBkD,YAEJnB,EAAAR,EAAEJ,OAAOI,EAAEZ,WACzBQ,EAAOQ,KAAKJ,EAAEJ,OAAOI,EAAEZ,YACrBY,EAAAZ,YAOH,GACCY,EAAEZ,WAAaY,EAAEH,aAChBG,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiBkD,YACjB3B,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACrBP,EAAiBuD,UAEZ,OAAAzB,EACNC,EACA,UACA,KAIF,GACCR,EAAEJ,OAAOI,EAAEZ,WAAWJ,OACtBP,EAAiBuD,UAGV,OADLhC,EAAAZ,YACK,CACNJ,KAAM,EACNsC,KAAM1B,GAOMY,EAAAR,EAAEJ,OAAOI,EAAEZ,WAEzB,MAAMwC,EAAa7B,EAClBC,EACAvB,EAAiBkD,WACjBlD,EAAiBoD,aAYlB,OANID,EAAW9B,OAAS,IAEtBU,EAAAoB,EAAWA,EAAW9B,OAAS,IAKV,IAAtB8B,EAAW9B,QACXU,EAAYxB,OACXP,EAAiBoD,YAEXtB,EACNC,EACA,WACA,MAIFoB,EAAWF,MAEJ,CACN1C,KAAM,EACNuD,YAAa3C,EACb0B,KAAMQ,EACLnC,EAAWiC,KACZ,EAIWE,EACZ9B,IAEA,MAAMwC,EAAuB,GACzB,IAAAnB,EACJ,KAEY,KADVA,EAAOF,EAA6BnB,IACnChB,OAEFwD,EAAMpC,KAAKiB,GACO,IAAdA,EAAKrC,QAKH,OAAAwD,CAAA,ECxyBKC,EAERC,IACE,MAAAC,GAAEA,GAAOD,EAGd,OAAAE,EAAAC,IAACC,EAAA,CACAH,GAAI,CACHI,SAAU,WACVC,MAAO,OACPC,OAAQ,UACLN,GAGJO,SAAAN,EAAAC,IAAC,MAAA,CACAM,MAAM,6BACNC,oBAAoB,OACpBC,KAAK,OACLC,QAAQ,UACRC,YAAY,MAEZL,SAAAN,EAAAC,IAAC,OAAA,CACAW,GAAG,IACHC,GAAG,IACHC,GAAG,IACHC,GAAG,IACHC,OAAO,eACPC,cAAc,aAEhB,EC7BUC,EAERpB,IACE,MAAAC,GAAEA,GAAOD,EAGd,OAAAE,EAAAC,IAACC,EAAA,CACAH,GAAI,CACHI,SAAU,WACVC,MAAO,OACPC,OAAQ,UACLN,GAGJO,SAAAN,EAAAC,IAAC,MAAA,CACAM,MAAM,6BACNC,oBAAoB,OACpBC,KAAK,OACLC,QAAQ,UACRC,YAAY,MAEZL,SAAAN,EAAAC,IAAC,OAAA,CACAW,GAAG,IACHC,GAAG,IACHC,GAAG,IACHC,GAAG,IACHC,OAAO,eACPC,cAAc,aAEhB,ECTGE,EACLrB,IAEM,MAAAQ,SACLA,EAAAc,UACAA,EAAAC,aACAA,EAAAC,WACAA,EAAAC,YACAA,GACGzB,EAEH,OAAAE,EAAAC,IAACuB,EAAA,CACAzB,GAAI,CACH0B,YAAa,QACbC,gBAAiBJ,EAAa,EAAI,EAClCK,eAAgBP,EAAY,EAAI,EAChCQ,kBAAmBP,EAAe,EAAI,EACtCQ,iBAAkBN,EAAc,EAAI,GAGpCjB,YAAA,EASEwB,EAEDhC,IACJ,MAAMQ,SAAEA,KAAayB,GAASjC,EAG7B,OAAAE,EAAAC,IAAC+B,EAAA,CACAC,QAAS,OACLF,EACJhC,GAAI,CACHmC,WAAY,YACZC,UAAW,aACXC,qBAAsB,gBACnBL,EAAKhC,IAGRO,SAAYA,GAAA,KAAA,EAaV+B,EACLvC,IAEA,MAAMd,WAAEA,KAAe+C,GAASjC,EAEhC,IAAIwC,EAWJ,YAVmB,IAAftD,IACQsD,EAAAtD,EACTuD,KAAKpG,GAAUA,EAAME,OACrBmG,KAAK,IACLC,OACsB,IAApBH,EAASpF,SACDoF,OAAA,UAKXnB,EAAgB,IAAGY,EACnBzB,eAACwB,EAAA,CACCxB,cAEH,EAaWoC,EAER5C,IACJ,MAAM6C,gBAAEA,EAAAjE,KAAiBA,KAASqD,GACjCjC,EAED,IAAI8C,OAGiB,IAApBD,GACAA,EAAgBzF,OAAS,IAET0F,EAAAD,EACdJ,KAAKpG,GAAUA,EAAME,OACrBmG,KAAK,IACLC,QAEH,IAAII,EACH7C,EAAAC,IAACoC,EAAA,CACAjB,WAAS,EACTE,YAAU,IAeX,OAZG5C,EAAKxB,OAAS,IACjB2F,EAAWnE,EAAK6D,KAAI,CAACO,EAASC,IAC7B/C,EAAAC,IAAC+C,GAAA,CAEA5B,WAAS,EACTE,YAAU,EACV7C,KAAMqE,GAHD,WAAWC,UASlBE,KAAC9B,EAAgB,IAAGY,EACnBzB,SAAA,GAAAL,IAAC6B,GACCxB,SACFsC,IACC3C,EAAAA,IAAAuB,EAAA,CAAI0B,YAAa,EAAI5C,SAASuC,MAChC,EAaWM,EAERrD,IACJ,MAAM6C,gBAAEA,EAAAjE,KAAiBA,KAASqD,GACjCjC,EAED,IAAI8C,OAGiB,IAApBD,GACAA,EAAgBzF,OAAS,IAET0F,EAAAD,EACdJ,KAAKpG,GAAUA,EAAME,OACrBmG,KAAK,IACLC,QAGH,IAAII,EACH7C,EAAAC,IAACoC,EAAA,CACAhB,cAAY,EACZC,YAAU,IAcX,OAXG5C,EAAKxB,OAAS,IACjB2F,EAAWnE,EAAK6D,KAAI,CAACO,EAASC,IAC7B/C,EAAAC,IAAC+C,GAAA,CAEAvE,KAAMqE,EACNzB,cAAY,EACZC,YAAU,GAHL,WAAWyB,UAQlBE,KAAC9B,EAAgB,IAAGY,EACnBzB,SAAA,CAACL,EAAAA,IAAAuB,EAAA,CAAI0B,YAAa,EAAI5C,SAASuC,MAC/B5C,IAAC6B,GACCxB,SACFsC,MACD,EAcWQ,EAERtD,IACE,MAAA6C,gBACLA,EAAArD,OACAA,EAAAC,SACAA,KACGwC,GACAjC,EAEJ,IAAI8C,OAGiB,IAApBD,GACAA,EAAgBzF,OAAS,IAET0F,EAAAD,EACdJ,KAAKpG,GAAUA,EAAME,OACrBmG,KAAK,IACLC,QAGH,IAAIY,EACHpD,EAAAA,IAACoC,EAAe,CAAAjB,WAAS,IAEtB9B,EAAOpC,OAAS,IACnBmG,EAAa/D,EAAOiD,KAAI,CAACO,EAASC,IACjC/C,EAAAC,IAAC+C,GAAA,CAEA5B,WAAS,EACT3C,KAAMqE,GAFD,SAASC,QAOjB,IAAIO,EACHrD,EAAAA,IAACoC,EAAe,CAAAjB,WAAS,IAezB,OAbG7B,EAASrC,OAAS,IACrBoG,EAAe/D,EAASgD,KACvB,CAACO,EAASC,IACT/C,EAAAC,IAAC+C,GAAA,CAEA5B,WAAS,EACT3C,KAAMqE,GAFD,SAASC,UASjB9C,IAACkB,EAAgB,IAAGY,EACnBzB,SAAAN,EAAAiD,KAACM,EAAA,CACAC,WAAS,EACTnD,OAAO,OAEPC,SAAA,CAAAN,EAAAC,IAACsD,EAAA,CACAE,MAAI,EACJC,GAAI,GAEJpD,WAACL,IAAA6B,EAAA,CAAqB6B,MAAM,SAC1BrD,SACFsC,MAED5C,EAAAC,IAACsD,EAAA,CACAE,MAAI,EACJC,GAAI,EAEJpD,SAAAN,EAAAiD,KAACzB,EAAA,CACAnB,OAAO,OACPuD,QAAQ,OACRC,WAAW,SACXC,eAAe,SACf3D,SAAS,WAETG,SAAA,CAAAN,EAAAC,IAAC6B,EAAA,CACA/B,GAAI,CACHgE,OAAQ,EACRC,gBAAiBC,EAAK,MAEvB3D,SAAA,WAGDL,IAACJ,EAAwB,CAAAqE,UAAU,eAGrClE,EAAAC,IAACsD,EAAA,CACAE,MAAI,EACJC,GAAI,EAEJpD,SAAAN,EAAAiD,KAACzB,EAAA,CACAnB,OAAO,OACPuD,QAAQ,OACRC,WAAW,SACXC,eAAe,SACf3D,SAAS,WAETG,SAAA,CAAAN,EAAAC,IAACiB,EAAwB,IACzBlB,EAAAC,IAAC6B,EAAA,CACA/B,GAAI,CACHgE,OAAQ,EACRC,gBAAiBC,EAAK,MAEvB3D,SAAA,eAKHN,EAAAC,IAACsD,EAAA,CACAE,MAAI,EACJC,GAAI,EAEJpD,SAAAN,EAAAC,IAACkE,EAAA,CACA9D,OAAO,OACPN,GAAI,CACHqE,YAAa,UACbC,iBAAkB,QAClBxC,iBAAkB,GAGlBvB,SAAA+C,MAGHrD,EAAAC,IAACsD,EAAA,CACAE,MAAI,EACJC,GAAI,EAEJpD,WAACL,IAAAkE,EAAA,CAAM9D,OAAO,OACZC,SACFgD,UAGH,EAaIgB,GACLxE,IAEA,MAAMyE,kBAAEA,EAAA7F,KAAmBA,KAASqD,GACnCjC,EAED,IAAI0E,OAGmB,IAAtBD,GACAA,EAAkBrH,OAAS,IAETsH,EAAAD,EAChBhC,KAAKpG,GAAUA,EAAME,OACrBmG,KAAK,IACLC,QAGH,IAAII,EACH7C,EAAAC,IAACoC,EAAA,CACAjB,WAAS,EACTE,YAAU,EACVC,aAAW,IAgBZ,OAbG7C,EAAKxB,OAAS,IACjB2F,EAAWnE,EAAK6D,KAAI,CAACO,EAASC,IAC7B/C,EAAAC,IAAC+C,GAAA,CAEAvE,KAAMqE,EACN1B,WAAS,EACTE,YAAU,EACVC,aAAW,GAJN,WAAWwB,UAUlBE,KAAC9B,EAAgB,IAAGY,EACnBzB,SAAA,CAACL,EAAAA,IAAA6B,EAAA,CAAqB6B,MAAM,SAC1BrD,SACFkE,IACCvE,EAAAA,IAAAuB,EAAA,CAAIiD,SAAU,EAAInE,SAASuC,MAC7B,EAgBI6B,GACL5E,IAEM,MAAA9B,QACLA,EAAAD,OACAA,EAAAzB,WACAA,EAAAC,WACAA,EAAA0B,YACAA,KAEG8D,GACAjC,EACE6E,EAAY,WAAWrI,gBAAyBC,MAAewB,IAC/D6G,EAAY,IAAIC,OAAO5G,GAAe,IAG3C,SAAAgF,KAAC9B,EAAgB,IAAGY,EACnBzB,SAAA,GAAAL,IAAC6B,GACCxB,SACFqE,IACC1E,EAAAA,IAAA6B,EAAA,CAAqBgD,SAAU,EAC9BxE,SACFtC,IACCiC,EAAAA,IAAA6B,EAAA,CAAqBgD,SAAU,EAC9BxE,SACFsE,MACD,EAYW5B,GACZlD,IAEA,MAAMrB,KAAEA,KAASsD,GAASjC,EAE1B,OAAQrB,EAAKrC,MACZ,KAAKS,EAAgBkI,MAEnB,OAAA/E,EAAAC,IAACyE,GAAA,IACI3C,EACJ9D,YAAaQ,EAAKR,YAClBD,QAASS,EAAKT,QACdD,OAAQU,EAAKV,OACbzB,WAAYmC,EAAKnC,WACjBC,WAAYkC,EAAKlC,aAGpB,KAAKM,EAAgBmI,SAEnB,OAAAhF,EAAAC,IAACqE,GAAA,CACAC,kBAAmB9F,EAAKkB,YACxBjB,KAAMD,EAAKC,QACPqD,IAGP,KAAKlF,EAAgBoI,WAEnB,OAAAjF,EAAAC,IAACyC,EAAA,IACIX,EACJY,gBAAiBlE,EAAKE,UACtBD,KAAMD,EAAKC,OAGd,KAAK7B,EAAgBqI,UAEnB,OAAAlF,EAAAC,IAACkD,EAAA,IACIpB,EACJY,gBAAiBlE,EAAKE,UACtBD,KAAMD,EAAKC,OAGd,KAAK7B,EAAgBsI,QAEnB,OAAAnF,EAAAC,IAACmD,EAAA,IACIrB,EACJY,gBAAiBlE,EAAKE,UACtBW,OAAQb,EAAKa,OACbC,SAAUd,EAAKc,WAGlB,KAAK1C,EAAgBuI,QAEnB,OAAApF,EAAAC,IAACoC,EAAA,IACIN,EACJ/C,WAAYP,EAAKC,OAIrB,aAAQ2G,WAAS,CAAA,EAAA,EC5fLC,GAERxF,IACJ,MAAMF,MAAEA,EAAA2F,GAAOA,EAAIC,SAAAA,GAAa1F,EAEhC,IAAI2F,EACHzF,EAAAC,IAAC+B,EAAA,CACAE,WAAW,YACXwD,UAAU,SACVpF,SAAA,wBAkBD,OAdGV,EAAM1C,OAAS,IAClBuI,EAAY7F,EAAM2C,KAAI,CAAC9D,EAAMsE,IAC5B/C,EAAAC,IAAC+C,GAAA,CAEAvE,OACA6C,YAAU,EACVF,WAAS,EACTG,aAAW,EACXF,aAAc0B,IAAUnD,EAAM1C,OAAS,GALlC,kBAAkB6F,QAWzB/C,EAAAC,IAACuB,EAAA,CACAzB,GAAI,IACAyF,EACHxB,gBAAiBC,EAAK,KACtBG,YAAaH,EAAK,KAClB5D,OAAQ,QAGTC,SAAAN,EAAAC,IAACuB,EAAA,CACA+D,KACAxF,GAAI,CACH4F,SAAU,QACV3B,gBAAiBC,EAAK,KACtBG,YAAaH,EAAK,MAGlB3D,SAAAmF,KACF,ECjDUG,GAER9F,IACE,MAAA+F,MAAEA,EAAOC,cAAAA,GAAkBhG,EAGhC,OAAAE,EAAAC,IAAC8F,EAAA,CACAF,QACAG,SAAUF,EACVG,MAAM,OACNC,WAAY,CAACC,EAAWC,eAAY,ECZ1BC,GAERvG,IACJ,MAAMwG,UAAEA,KAAcvE,GAASjC,EAE/B,OAAIwG,EAEDrG,EAAAA,IAAAsG,EAAA,CAAQC,MAAOzE,EAAKzB,SACpBA,SAAAN,EAAAiD,KAACwD,EAAA,IACI1E,EACJ2E,eAAW,EACXC,aAAS,EAERrG,SAAA,CAAKyB,EAAA2E,UACL3E,EAAK4E,aAOT3G,EAAAC,IAACwG,EAAA,IACI1E,EACJ2E,UAAW3E,EAAK2E,UAChBC,QAAS5E,EAAK4E,QAEbrG,SAAKyB,EAAAzB,UAAA,ECXIsG,GACZ9G,IAEM,MAAA+G,WACLA,EAAAC,cACAA,EAAAC,eACAA,GACGjH,EAEEkH,EAAYC,EAAAA,OACjB,OAGAC,EACAC,GACGC,EAAAA,SAAS,IAENC,EAAaC,GAAkBF,EAAAA,SChCR,CAC9BG,IAEM,MACAC,EADM,IAAIC,IAAIF,GAEfG,aAAaC,IAAI,WAErB,OAAiB,OAAjBH,GACiB,SAAjBA,CAAiB,EDyBjBI,CAAgBC,OAAOC,SAASC,OAM3BC,EAAoBC,GACxBhC,GAAUA,EAAMiC,YAAYC,KAAK,QAanC,OAVAC,EAAAA,WAAU,KACiB,OAAtBpB,EAAUqB,SAGdlB,EACCH,EAAUqB,QAAQC,wBAChBjI,OAAA,GAED,CAAC2G,WAGFxF,EACA,CAAAlB,SAAA,CAAAN,EAAAC,IAACsI,EAAA,CACAC,IAAKxB,EACLyB,QAAM,EACNC,UAAW,EACX3I,GAAI,CACHkC,QAAS,GAGV3B,SAAAN,EAAAiD,KAACkB,EAAA,CACAP,QAAQ,OACR+E,UAAU,MACV7E,eAAe,gBAEfxD,SAAA,GAAC2C,KAAA2F,EAAA,CAAYC,QAAQ,WACpBvI,SAAA,CAAAL,MAACwG,EAAO,CAAAqC,QAlCe,KACZxB,GAACyB,IAAUA,GAAI,EAkCxBzI,SAAA+G,EACE,YACA,cACM,IACVrH,EAAAC,IAACwG,EAAA,CACAsB,KAAK,mFACLtC,UAAU,IACVuD,OAAO,SACPrC,cAAUsC,EAAc,IACxB3I,SAAA,YAIDuG,OAGF5G,MAAAuB,EAAA,CACAlB,SAAC2C,EAAAA,KAAAM,EAAA,CAAKC,WAAS,EACdlD,SAAA,CAAAN,EAAAC,IAACsD,EAAA,CACAE,MAAI,EACJC,GAAI,GACJwF,GAAI,EACJtF,QACCyD,EAAc,YAAS,EAGxB/G,SAAAN,EAAAC,IAACuB,EAAA,CACA2H,SAAS,OACT9I,OAAQ,gBAAgB6G,OAEvB5G,SAAAwG,MAGH9G,EAAAC,IAACsD,EAAA,CACAE,MAAI,EACJC,IAAE,EACFwF,IAAE,EACFtF,QACCoE,IAAsBX,EACnB,YACA,EAGJ/G,SAAAN,EAAAC,IAACuB,EAAA,CACA2H,SAAS,OACT9I,OAAQ,gBAAgB6G,OAEvB5G,SAAAyG,aAKN,EE3FWqC,GAAiB,KACvB,MAAAC,gBAAEA,GAAoBC,KACtBC,WAAEA,EAAAC,UAAYA,EAAWC,UAAAA,ICjC/BC,EDmCE,6BCeK,CACND,UAjDiBE,UACjB,MAAMC,EAAWC,SAASC,eACzBJ,GAED,OAAiB,OAAbE,GAGGG,EAAMH,GAAUI,MAAMC,GACf,OAATA,aAGGA,EAAM,gBACN,IACP,EAqCDV,WAlBkBI,UAClB,MAAMC,EAAWC,SAASC,eACzBJ,GAED,OAAiB,OAAbE,GAGGM,EAAON,GAAUI,MAAMC,GAChB,OAATA,aAGGA,EAAM,gBACN,IACP,EAMDT,UAnCiBG,UACjB,MAAMC,EAAWC,SAASC,eACzBJ,GAED,OAAiB,OAAbE,GAGGO,EAAMP,GAAUI,MAAMC,GACf,OAATA,aAGGA,EAAM,gBACN,IACP,IAhC6B,IAC/BP,EDqCM,MAAAU,cAAEA,EAAeC,iBAAAA,GE3CQ,EAC/BC,EACAC,KAEA,MAAOH,EAAeI,GACrBpD,YAAS,KACF,MAEA1K,EAFM,IAAI+K,IAAI6C,GAGf5C,aAAaC,IAAI,WACtB,GAAgB,OAAZjL,EAKI,OAJPmL,OAAO4C,aAAaC,QACnBH,EACA7N,GAEMA,EAGF,MAAAiO,EACL9C,OAAO4C,aAAaG,QACnBL,GAEF,OAAqB,OAAjBI,EACIA,EAED,EAAA,IAWF,MAAA,CAAEP,gBAAeC,iBARE3N,IACzB8N,EAAsB9N,GACtBmL,OAAO4C,aAAaC,QACnBH,EACA7N,EAAA,IFYDmO,CACChD,OAAOC,SAASC,KAChB,mBAEIC,EAAoBC,GACxBhC,GAAUA,EAAMiC,YAAYC,KAAK,SAG5BvI,EAAOkL,GAAY1D,EAAAA,SAExB,KAED2D,EACAC,GACG5D,EAAAA,SAAmC,MAEvCgB,EAAAA,WAAU,KACT,MAAMpL,EV4EyB,CAChCd,IAEA,MAAMc,EAAyB,GAC3B,IAAAb,EACJ,KAEY,KADVA,EAAQF,EAA6BC,IACpCE,MAEFY,EAAOQ,KAAKrB,GAEN,OAAAa,CAAA,EUvFSiO,CVSQ,CACxBvO,IAEA,MAAMwO,EA7BgB,CACtBxO,IAEA,IAAIyO,EAAe,GAEfC,EAAa,EACV,KAAAA,EAAa1O,EAAQQ,QAAQ,CACnC,GACCkO,EAAa,EAAI1O,EAAQQ,QACD,MAAxBR,EAAQ0O,IACoB,MAA5B1O,EAAQ0O,EAAa,GAErB,KACCA,EAAa1O,EAAQQ,QACG,OAAxBR,EAAQ0O,IAERA,IAGFD,GAAgBzO,EAAQ0O,GACxBA,GACD,CAEO,OAAAD,CAAA,EAMgBE,CACtB3O,EAAQ4O,aAGF,MAAA,CACN5O,QAASwO,EACTzO,cAAeyO,EAAehO,OAC9BV,UAAW,EACXD,WAAY,EACZD,WAAY,EAAA,EUpBXiP,CAAUnB,IAELxK,EAAQV,EACbnC,EAAWC,IAEZ8N,EAASlL,EAAK,GACZ,CAACwK,IAEJ,MAuBMoB,EAAsB7B,MAC3B8B,IAEWA,IAAEzB,MAAM0B,IACdA,EACHrC,EAAgB,mBAAoB,CACnCR,QAAS,SAIXQ,EACC,2BACA,CACCR,QAAS,SACV,GAED,EAGF,cACExD,WACA,CAAA/E,SAAA,CAAAN,EAAAC,IAAC2G,GAAA,CACAC,WACC7G,EAAAiD,KAAC2F,EAAY,CAAAC,QAAQ,WACpBvI,SAAA,CAAAN,EAAAC,IAACoG,GAAA,CACAC,UAAW0B,EACXtB,gBAAYiF,EAAgB,IAC5B7C,QArCL8C,IAEAZ,EACCY,EAAMC,cAAA,EAqCFvL,SAAA,WAGDN,EAAAC,IAACoG,GAAA,CACAC,UAAW0B,EACXrB,cAAUmF,EAAY,IACtBhD,QA3DiB,KACtBiD,UAAUC,UAAUC,UD3EY,EACjC7B,EACA7C,KAEM,MAAA2E,EAAM,IAAIzE,IAAIF,GAGpB,OAFI2E,EAAAxE,aAAayE,IAAI,UAAW,QAC5BD,EAAAxE,aAAayE,IAAI,UAAW/B,GACzB8B,EAAInE,IAAA,ECqETqE,CACChC,EACAvC,OAAOC,SAASC,OAGlBsB,EAAgB,2BAA4B,CAC3CR,QAAS,QACT,EAmDIvI,SAAA,aAKHwG,cACC9G,EAAAC,IAAC2F,GAAA,CACAC,MAAOuE,EACPtE,cAAeuE,IAGjBtD,eACC/G,EAAAC,IAACqF,GAAA,CACA1F,QACA2F,GAAG,6BACHC,SAAU,CACTvD,QAAS,EACToK,WAAY,YAKhBrM,EAAAC,IAACqM,EAAA,CACAC,aAAc,CACbC,SAAU,SACVC,WAAY,QAEbC,gBAAiB,CAChBF,SAAU,MACVC,WAAY,QAEbE,SAAU5B,EACV6B,KAAkC,OAA5B7B,EACN8B,QA1EkC,KACpC7B,EAA2B,KAAI,EA2E7B1K,SAAAN,EAAAC,IAACsI,EAAA,CACAxI,GAAI,CACHkC,QAAS,GAGV3B,gBAACwM,EACA,CAAAxM,SAAA,CAAAN,EAAAiD,KAAC8J,EAAA,CACAjE,QAAS,IACR0C,EAAoBjC,GAGrBjJ,SAAA,OAAC0M,EACA,CAAA1M,SAAAL,EAAAA,IAAC0L,EAAgB,CAAAsB,SAAS,cAE3BhN,IAACiN,GAAa5M,SAEd,oBAEDN,EAAAiD,KAAC8J,EAAA,CACAjE,QAAS,IACR0C,EAAoBhC,GAGrBlJ,SAAA,OAAC0M,EACA,CAAA1M,SAAAL,EAAAA,IAAC0L,EAAgB,CAAAsB,SAAS,cAE3BhN,IAACiN,GAAa5M,SAEd,mBAEDN,EAAAiD,KAAC8J,EAAA,CACAjE,QAAS,IACR0C,EAAoB/B,GAGrBnJ,SAAA,OAAC0M,EACA,CAAA1M,SAAAL,EAAAA,IAAC0L,EAAgB,CAAAsB,SAAS,cAE3BhN,IAACiN,GAAa5M,SAEd,4BAKL,EG3MI6M,GAAYC,EAAY,CAC7BC,QAAS,CACRC,KAAM,UAIKC,GAAU,WAEpBlI,WACA,CAAA/E,SAAA,CAAAN,EAAAC,IAACuN,EAAY,MACbvN,IAACwN,EAAc,CAAAxH,MAAOkH,GACrB7M,SAAAN,EAAAC,IAACyN,EAAA,CACAC,kBAAgB,EAChBC,iBAAkB,IAClBrB,aAAc,CACbC,SAAU,MACVC,WAAY,UAGbnM,eAAC8I,GAAW,WCzBjByE,EAASC,WACRjE,SAASC,eAAe,SACvBiE,aACAC,EAAMC,WAAN,CACA3N,SAAAL,EAAAA,IAACsN,IAAI"}